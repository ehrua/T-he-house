<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>탈출</title>
<style>
body{
  background:#000;
  color:#eee;
  font-family:"Noto Serif KR",serif;
  line-height:1.7;
}
#game{
  max-width:820px;
  margin:40px auto;
  padding:20px;
}
.part{
  border-top:2px solid #333;
  margin-top:30px;
  padding-top:20px;
}
button{
  width:100%;
  padding:12px;
  margin:8px 0;
  background:#111;
  color:#eee;
  border:1px solid #444;
  cursor:pointer;
}
button:hover{background:#222;}
.keypad{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:8px;
}
.display{
  background:#111;
  padding:10px;
  margin-bottom:10px;
  text-align:center;
  letter-spacing:4px;
}
h2{margin-top:0;}
.alarm{color:#f33;}
</style>
</head>
<body>
<div id="game"></div>

<script>
const game=document.getElementById("game");

const state={
  tweezers:false,
  basementKey:false,
  frontKey:false,
  caught:0,
  deathReason:"",
  input:"",
  history:[]
};

/* ===== 공통 렌더 ===== */
function render(text,options=[],back=false){
  game.innerHTML=text;
  if(back && state.history.length){
    const b=document.createElement("button");
    b.innerText="뒤로 가기";
    b.onclick=()=>state.history.pop()();
    game.appendChild(b);
  }
  options.forEach(o=>{
    const btn=document.createElement("button");
    btn.innerText=o.text;
    btn.onclick=()=>{
      state.history.push(()=>render(text,options,back));
      o.action();
    };
    game.appendChild(btn);
  });
}

/* ===== 납치범 로직 ===== */
function hunter(next){
  state.caught++;
  if(state.caught===1){
    basementCaptured("몽둥이에 맞아 정신을 잃었다.");
  }else{
    state.deathReason="도끼가 내려찍혔다. 이번엔 끝이다.";
    death();
  }
}

/* ================= 시작 ================= */
function part0(){
render(`
<div class="part">
<h2>PART 0 : 새벽의 공원</h2>
<p>강아지와 산책 중이었다.<br>퍽.</p>
</div>
`,[{text:"눈을 뜬다",action:room}]);
}

/* ================= 방 ================= */
function room(){
render(`
<div class="part">
<h2>방</h2>
<p>신문지로 막힌 창문, 잠긴 문.</p>
</div>
`,[
{text:"문",action:door},
{text:"방 조사",action:searchRoom},
{text:"가만히",action:()=>hunter()}
]);
}

function searchRoom(){
render(`<p>장기 매매 기록. 이름: 판태현.</p>`,[
{text:"서랍",action:()=>{state.tweezers=true; render("<p>핀셋을 얻었다.</p>",[{text:"뒤로",action:room}]);}},
{text:"침대 밑",action:()=>hunter()}
],true);
}

function door(){
if(!state.tweezers){
render("<p>문이 잠겨 있다.</p>",[{text:"뒤로",action:room}]);
return;
}
render("<p>문이 열린다.</p>",[{text:"밖으로",action:secondFloor}]);
}

/* ================= 2층 ================= */
function secondFloor(){
render("<div class='part'><h2>2층</h2></div>",[
{text:"서재",action:library},
{text:"계단",action:kitchen}
]);
}

function library(){
render(`
<div class="part">
<h2>서재</h2>
<p>해부학 책과 사진들.</p>
</div>
`,[
{text:"메모",action:()=>render("<p>탈출은 두 갈래다.</p>",[{text:"뒤로",action:library}])},
{text:"서랍",action:()=>{state.basementKey=true; render("<p>지하실 열쇠 획득.</p>",[{text:"뒤로",action:library}]);}},
{text:"나간다",action:secondFloor}
],true);
}

/* ================= 주방 / 화장실 ================= */
function kitchen(){
render("<div class='part'><h2>주방</h2><p>발소리가 가까워진다.</p></div>",[
{text:"화장실",action:bathroom},
{text:"거실",action:livingroom}
]);
}

function bathroom(){
render("<div class='part'><h2>화장실</h2></div>",[
{text:"숨는다",action:()=>hunter()}
]);
}

/* ================= 거실 ================= */
function livingroom(){
render("<div class='part'><h2>거실</h2></div>",[
{text:"TV",action:()=>render("<p>TV에 숫자 3849가 반복된다.</p>",[{text:"뒤로",action:livingroom}])},
{text:"지하실",action:basement},
{text:"현관",action:frontDoor}
]);
}

/* ================= 지하실 ================= */
function basement(){
if(!state.basementKey){
render("<p>지하실 문은 잠겨 있다.</p>",[{text:"뒤로",action:livingroom}]);
return;
}
render(`
<div class="part">
<h2>지하실</h2>
<p>판자로 막힌 출구가 보인다.</p>
</div>
`,[
{text:"판자를 부순다",action:basementEscape},
{text:"돌아간다",action:livingroom}
]);
}

function basementCaptured(reason){
render(`
<div class="part">
<h2>지하실</h2>
<p>${reason}<br>쇠사슬 소리가 난다.</p>
</div>
`,[
{text:"버틴다",action:secondFloor}
]);
}

function basementEscape(){
render(`
<h2>지하실 탈출 엔딩</h2>
<p>판자를 부수고 밖으로 기어 나왔다.<br>살아남았다.</p>
`);
}

/* ================= 현관 ================= */
function frontDoor(){
state.input="";
render(`
<h2>현관 도어락</h2>
<div class="display">${state.input}</div>
<div class="keypad" id="pad"></div>
`,[],true);

const pad=document.getElementById("pad");
for(let i=1;i<=9;i++) addKey(i);
addKey(0);
addKey("확인",checkDoor);
addKey("←",()=>{state.input=state.input.slice(0,-1);frontDoor();});
}

function addKey(v){
const b=document.createElement("button");
b.innerText=v;
b.onclick=()=>{
  if(typeof v==="number"){
    state.input+=v;
    frontDoor();
  }
};
document.getElementById("pad").appendChild(b);
}

function checkDoor(){
if(state.input==="3849"){
render("<h2>현관 탈출 엔딩</h2><p>문이 열렸다. 새벽 공기.</p>");
}else{
render(`
<h2 class="alarm">경보</h2>
<p>삐— 삐—<br>그가 달려온다.</p>
`,[
{text:"도망친다",action:()=>hunter()}
]);
}
}

/* ================= 사망 ================= */
function death(){
render(`<h2>사망</h2><p>${state.deathReason}</p>`);
}

part0();
</script>
</body>
</html>
