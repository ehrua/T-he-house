<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>íƒˆì¶œ</title>
<style>
body{
  background:#000;
  color:#eee;
  font-family:"Noto Serif KR",serif;
  line-height:1.7;
}
#game{max-width:820px;margin:40px auto;padding:20px;}
.part{border-top:2px solid #333;margin-top:30px;padding-top:20px;}
button{
  width:100%;padding:12px;margin:8px 0;
  background:#111;color:#eee;border:1px solid #444;cursor:pointer;
}
button:hover{background:#222;}
.keypad{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;}
.display{
  background:#111;
  padding:12px;
  margin-bottom:10px;
  text-align:center;
  letter-spacing:6px;
  font-size:20px;
}
.alarm{color:#f33;font-weight:bold;}
h2{margin-top:0;}
</style>
</head>

<body>
<div id="game"></div>

<script>
const game=document.getElementById("game");
const state={
  tweezers:false,
  basementKey:false,
  safeKey:false,
  frontKey:false,
  caught:0,
  deathReason:"",
  input:"",
  history:[],
  hunterTimer:null
};

/* ===== ê³µí†µ ë Œë” ===== */
function render(text,options=[],back=false){
  clearTimeout(state.hunterTimer);
  game.innerHTML=text;

  // ğŸ”´ ë‚©ì¹˜ë²” íƒ€ì´ë¨¸ (12~22ì´ˆ)
  if(Math.random()<0.35){
    state.hunterTimer=setTimeout(()=>{
      state.deathReason="ë„ˆë¬´ ì˜¤ë˜ ë¨¸ë¬¼ë €ë‹¤. ë°œì†Œë¦¬ê°€ ë°”ë¡œ ë’¤ì—ì„œ ë©ˆì·„ë‹¤.";
      death();
    },12000+Math.random()*10000);
  }

  if(back && state.history.length){
    const b=document.createElement("button");
    b.innerText="ë’¤ë¡œ ê°€ê¸°";
    b.onclick=()=>state.history.pop()();
    game.appendChild(b);
  }
  options.forEach(o=>{
    const btn=document.createElement("button");
    btn.innerText=o.text;
    btn.onclick=()=>{
      state.history.push(()=>render(text,options,back));
      o.action();
    };
    game.appendChild(btn);
  });
}

/* ===== ëœë¤ ë‚©ì¹˜ë²” ===== */
function randomHunter(next){
  if(Math.random()<0.25){
    state.caught++;
    state.deathReason="ìˆ¨ì„ ê³ ë¥´ëŠ” ìˆœê°„, ê¸°ì²™ì´ ë°”ë¡œ ë“± ë’¤ì— ìˆì—ˆë‹¤.";
    if(state.caught===1) basementCaptured();
    else death();
  }else next();
}

/* ================= ì‹œì‘ ================= */
function part0(){
render(`
<div class="part">
<h2>PART 0 : ìƒˆë²½ì˜ ê³µì›</h2>
<p>í½.<br>ë’¤í†µìˆ˜ì˜ ì¶©ê²©.</p>
</div>
`,[{text:"ëˆˆì„ ëœ¬ë‹¤",action:room}]);
}

/* ================= ë°© ================= */
function room(){
render(`
<div class="part">
<h2>ë°©</h2>
<p>ì‹ ë¬¸ì§€ë¡œ ë§‰íŒ ì°½ë¬¸. ì ê¸´ ë¬¸.</p>
</div>
`,[
{text:"ë¬¸",action:door},
{text:"ë°© ì¡°ì‚¬",action:searchRoom},
{text:"ê°€ë§Œíˆ",action:wait}
]);
}

function searchRoom(){
render(`<p>ì¥ê¸° ë§¤ë§¤ ê¸°ë¡â€¦ ì´ë¦„: íŒíƒœí˜„</p>`,[
{text:"ì„œë",action:getTweezers},
{text:"ì¹¨ëŒ€ ë°‘",action:()=>{
  state.deathReason="ì‹œì²´ë¥¼ ê±´ë“œë¦¬ëŠ” ìˆœê°„ ë°”ë‹¥ì´ ì‚ê±±ì˜€ë‹¤.";
  randomHunter(room);
}}
],true);
}

function getTweezers(){
state.tweezers=true;
render(`<p>í•€ì…‹ì„ ì–»ì—ˆë‹¤.</p>`,[{text:"ë¬¸",action:door}]);
}

function door(){
if(!state.tweezers){
render(`<p>ë¬¸ì´ ì ê²¨ ìˆë‹¤.</p>`,[{text:"ë’¤ë¡œ",action:room}]);
return;
}
render(`<p>ë¬¸ì´ ì—´ë¦°ë‹¤.</p>`,[{text:"ë°–ìœ¼ë¡œ",action:secondFloor}]);
}

function wait(){
state.caught++;
state.deathReason="ì•„ë¬´ê²ƒë„ í•˜ì§€ ì•ŠëŠ” ì„ íƒì´ ê°€ì¥ ìœ„í—˜í–ˆë‹¤.";
if(state.caught===1) basementCaptured();
else death();
}

/* ================= 2ì¸µ ================= */
function secondFloor(){
render(`<div class="part"><h2>2ì¸µ</h2></div>`,[
{text:"ì„œì¬",action:()=>randomHunter(library)},
{text:"ê³„ë‹¨",action:kitchen}
]);
}

function library(){
render(`<div class="part"><h2>ì„œì¬</h2><p>ì‚¬ì§„ê³¼ í•´ë¶€í•™ ì±….</p></div>`,[
{text:"ë©”ëª¨",action:memo},
{text:"ì„œë",action:getBasementKey},
{text:"ë‚˜ê°„ë‹¤",action:()=>randomHunter(secondFloor)}
],true);
}

function memo(){
render(`<p><i>TVì˜ ìˆ«ìë¥¼ ê¸°ì–µí•´ë¼. 3849</i></p>`,[{text:"ë’¤ë¡œ",action:library}]);
}

function getBasementKey(){
state.basementKey=true;
render(`<p>ì§€í•˜ì‹¤ ì—´ì‡  íšë“.</p>`,[{text:"ë’¤ë¡œ",action:library}]);
}

/* ================= ë‚©ì¹˜ ================= */
function basementCaptured(){
render(`<div class="part"><h2>ì§€í•˜ì‹¤</h2><p>ë¶™ì¡í˜€ ëŒë ¤ì™”ë‹¤.</p></div>`,[
{text:"ë²„í‹´ë‹¤",action:secondFloor}
]);
}

/* ================= ì£¼ë°© / í™”ì¥ì‹¤ ================= */
function kitchen(){
render(`<div class="part"><h2>ì£¼ë°©</h2><p>ì–´ë”˜ê°€ì—ì„œ ê¸°ì²™ì´ ì‚¬ë¼ì¡Œë‹¤.</p></div>`,[
{text:"í™”ì¥ì‹¤",action:()=>randomHunter(bathroom)},
{text:"ê±°ì‹¤",action:()=>randomHunter(livingroom)}
]);
}

function bathroom(){
render(`<div class="part"><h2>í™”ì¥ì‹¤</h2></div>`,[
{text:"ë¬¸ ë’¤",action:()=>randomHunter(livingroom)},
{text:"ë³€ê¸° ë’¤",action:()=>randomHunter(livingroom)},
{text:"ìš•ì¡°",action:()=>randomHunter(livingroom)}
]);
}

/* ================= ê±°ì‹¤ ================= */
function livingroom(){
render(`<div class="part"><h2>ê±°ì‹¤</h2></div>`,[
{text:"TV",action:tv},
{text:"ì„œë",action:livingDrawer},
{text:"ì§€í•˜ì‹¤",action:basement},
{text:"í˜„ê´€",action:frontDoor}
]);
}

function tv(){
render(`<p>TVì— 3849ê°€ ë°˜ë³µëœë‹¤.</p>`,[{text:"ë’¤ë¡œ",action:livingroom}]);
}

function livingDrawer(){
state.safeKey=true;
render(`<p>ê¸ˆê³  ì—´ì‡  íšë“.</p>`,[{text:"ë’¤ë¡œ",action:livingroom}]);
}

/* ================= ì§€í•˜ì‹¤ ================= */
function basement(){
if(!state.basementKey){
render(`<p>ì ê²¨ ìˆë‹¤.</p>`,[{text:"ë’¤ë¡œ",action:livingroom}]);
return;
}
render(`<div class="part"><h2>ì§€í•˜ì‹¤</h2></div>`,[
{text:"ê¸ˆê³ ",action:basementSafe},
{text:"ë‚˜ê°„ë‹¤",action:basementFreeMove}
]);
}

function basementSafe(){
if(!state.safeKey){
render(`<p>ê¸ˆê³ ëŠ” ì ê²¨ ìˆë‹¤.</p>`,[{text:"ë’¤ë¡œ",action:basement}]);
return;
}
state.frontKey=true;
render(`
<p>
ê¸ˆê³  ì•ˆì—ì„œ ì‘ì€ ì—´ì‡  í•˜ë‚˜ë¥¼ ë°œê²¬í–ˆë‹¤.<br>
<i>í˜„ê´€ ì—´ì‡ ë‹¤.</i>
</p>
`,[{text:"ë’¤ë¡œ",action:basement}]);
}

function basementFreeMove(){
render(`<p>ì´ë™</p>`,[
{text:"2ì¸µ",action:()=>randomHunter(secondFloor)},
{text:"ì£¼ë°©",action:()=>randomHunter(kitchen)},
{text:"ê±°ì‹¤",action:()=>randomHunter(livingroom)},
{text:"í˜„ê´€",action:frontDoor}
],true);
}

/* ================= í˜„ê´€ í‚¤íŒ¨ë“œ ================= */
function frontDoor(){
render(`
<h2>í˜„ê´€ ë„ì–´ë½</h2>
<p>ì…ë ¥ëœ ìˆ«ì</p>
<div class="display">${state.input}</div>
<div class="keypad" id="pad"></div>
`,[],true);

const pad=document.getElementById("pad");

[1,2,3,4,5,6,7,8,9,0].forEach(n=>{
  const b=document.createElement("button");
  b.innerText=n;
  b.onclick=()=>{
    state.input+=n;
    frontDoor();
  };
  pad.appendChild(b);
});

const ok=document.createElement("button");
ok.innerText="í™•ì¸";
ok.onclick=checkDoor;
pad.appendChild(ok);

const del=document.createElement("button");
del.innerText="â†";
del.onclick=()=>{
  state.input=state.input.slice(0,-1);
  frontDoor();
};
pad.appendChild(del);
}

function checkDoor(){
if(!state.frontKey){
state.deathReason="ë„ì–´ë½ì€ ë°˜ì‘ì´ ì—†ë‹¤. ì—´ì‡ ê°€ í•„ìš”í•˜ë‹¤.";
death();
return;
}
if(state.input==="3849"){
render(`<h2>ìƒì¡´ ì—”ë”©</h2><p>ë¬¸ì´ ì—´ë¦¬ê³  ìƒˆë²½ ê³µê¸°ê°€ ë°€ë ¤ì˜¨ë‹¤.</p>`);
}else{
state.deathReason="ê²½ë³´ìŒì´ ìš¸ë ¸ê³ , ë°œì†Œë¦¬ê°€ ë¹ ë¥´ê²Œ ë‹¤ê°€ì™”ë‹¤.";
death();
}
}

/* ================= ì‚¬ë§ ================= */
function death(){
clearTimeout(state.hunterTimer);
render(`<h2>ì‚¬ë§</h2><p>${state.deathReason}</p>`);
}

part0();
</script>
</body>
</html>
