<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>탈출</title>
<style>
body {
    background:#000;
    color:#eee;
    font-family: "Malgun Gothic", sans-serif;
}
#game {
    max-width: 800px;
    margin: 40px auto;
    padding: 20px;
}
.choice button {
    display:block;
    margin:8px 0;
    padding:10px;
    width:100%;
    background:#111;
    color:#eee;
    border:1px solid #444;
    cursor:pointer;
}
.choice button:hover {
    background:#222;
}
.keypad {
    display:grid;
    grid-template-columns: repeat(3, 1fr);
    gap:6px;
    margin-top:10px;
}
.keypad button {
    padding:15px;
    font-size:18px;
}
.display {
    background:#111;
    border:1px solid #555;
    padding:10px;
    margin-bottom:10px;
    font-size:18px;
    letter-spacing:4px;
}
</style>
</head>

<body>
<audio id="bgm" src="bgm.mp3" loop></audio>
<audio id="sfxClick" src="click.mp3"></audio>
<audio id="sfxDoor" src="door.mp3"></audio>

<div id="game"></div>

<script>
const game = document.getElementById("game");
const bgm = document.getElementById("bgm");
const click = document.getElementById("sfxClick");
const door = document.getElementById("sfxDoor");

bgm.volume = 0.3;
bgm.play().catch(()=>{});

let state = {
    location: "거실",
    basementKey: false,
    safeKey: false,
    frontKey: false,
    chances: 2,
    kidnapperTimer: null
};

function playClick(){ click.currentTime=0; click.play(); }

function setKidnapperTimer(){
    clearTimeout(state.kidnapperTimer);
    state.kidnapperTimer = setTimeout(()=>{
        if(state.chances > 1){
            state.chances--;
            showText("등 뒤에서 손이 뻗어왔다.\n\n정신을 차렸을 때, 너는 지하실 바닥에 쓰러져 있다.\n(기회가 하나 줄었다)");
            state.location = "지하실";
            renderBasement();
        } else {
            showText("뒤에서 들려온 숨소리.\n\n이번엔 끝이다.\n너는 다시 눈을 뜨지 못했다.\n\n[사망]");
        }
    }, 90000); // 납치범 등장 시간 (1분 30초)
}

function showText(text){
    game.innerHTML = `<p>${text.replace(/\n/g,"<br>")}</p>`;
}

function addChoices(choices){
    const div = document.createElement("div");
    div.className="choice";
    choices.forEach(c=>{
        const b=document.createElement("button");
        b.textContent=c.text;
        b.onclick=()=>{ playClick(); c.action(); };
        div.appendChild(b);
    });
    game.appendChild(div);
}

function start(){
    showText("공원에서 강아지와 산책을 하다 뒤에서 무언가에 맞았다.\n\n눈을 뜨니 낯선 집이다.");
    addChoices([
        {text:"거실을 살핀다", action:()=>{ state.location="거실"; renderLiving(); }}
    ]);
    setKidnapperTimer();
}

/* 거실 */
function renderLiving(){
    showText("거실이다. 숨 막히는 정적.\n서랍과 문들이 보인다.");
    addChoices([
        {text:"서랍을 연다", action:()=>{
            if(!state.safeKey){
                state.safeKey=true;
                showText("서랍 안에서 작은 열쇠를 발견했다.\n[금고 열쇠 획득]");
            } else showText("이미 뒤져본 서랍이다.");
            renderLiving();
        }},
        {text:"주방으로 간다", action:()=>{ state.location="주방"; renderKitchen(); }},
        {text:"계단으로 내려간다", action:()=>{
            if(state.basementKey){
                state.location="지하실";
                renderBasement();
            } else {
                showText("문이 잠겨 있다.\n지하실 열쇠가 필요하다.");
                renderLiving();
            }
        }},
        {text:"현관으로 간다", action:()=>{ renderFrontDoor(); }}
    ]);
}

/* 주방 */
function renderKitchen(){
    showText("주방이다.\n어디선가 발소리가 들린다.");
    addChoices([
        {text:"화장실로 도망간다", action:()=>{ renderBathroom(); }},
        {text:"거실로 돌아간다", action:()=>{ renderLiving(); }}
    ]);
}

/* 화장실 */
function renderBathroom(){
    showText("화장실이다.\n숨을 곳이 보인다.");
    addChoices([
        {text:"문 뒤에 숨는다", action:()=>{ hideSuccess(); }},
        {text:"변기 뒤에 숨는다", action:()=>{ hideSuccess(); }},
        {text:"욕조 안에 숨는다", action:()=>{ hideSuccess(); }}
    ]);
}
function hideSuccess(){
    showText("숨을 죽이고 기다렸다.\n\n발소리가 멀어진다.");
    setKidnapperTimer();
    renderBathroom();
}

/* 지하실 */
function renderBasement(){
    showText("축축한 지하실.\n구석에 금고가 있다.");
    addChoices([
        {text:"금고를 조사한다", action:()=>{
            if(!state.safeKey){
                showText("금고는 단단히 잠겨 있다.");
            } else if(!state.frontKey){
                state.frontKey=true;
                showText("금고 안에서 현관 열쇠를 발견했다.");
            } else {
                showText("이미 비어 있다.");
            }
            renderBasement();
        }},
        {text:"나간다", action:()=>{
            renderFreeMove();
        }}
    ]);
}

/* 자유 이동 */
function renderFreeMove(){
    showText("어디로 갈까?");
    addChoices([
        {text:"2층", action:()=>{ showText("잠긴 방들뿐이다."); renderFreeMove(); }},
        {text:"화장실", action:()=>{ renderBathroom(); }},
        {text:"거실", action:()=>{ renderLiving(); }},
        {text:"주방", action:()=>{ renderKitchen(); }},
        {text:"현관", action:()=>{ renderFrontDoor(); }}
    ]);
}

/* 현관 */
function renderFrontDoor(){
    if(!state.frontKey){
        showText("현관문은 잠겨 있다.\n열쇠가 필요하다.");
        renderFreeMove();
        return;
    }
    let input="";
    game.innerHTML = `
        <p>현관 키패드</p>
        <div class="display" id="disp"></div>
        <div class="keypad" id="pad"></div>
    `;
    const disp=document.getElementById("disp");
    const pad=document.getElementById("pad");
    "1234567890".split("").forEach(n=>{
        const b=document.createElement("button");
        b.textContent=n;
        b.onclick=()=>{
            playClick();
            input+=n;
            disp.textContent=input;
            if(input==="3849"){
                door.play();
                renderPhone();
            }
        };
        pad.appendChild(b);
    });
}

/* 공중전화 */
function renderPhone(){
    let input="";
    game.innerHTML=`
        <p>집 밖.\n공중전화가 있다.\n아래에 메모: 3849</p>
        <div class="display" id="pdisp"></div>
        <div class="keypad" id="ppad"></div>
    `;
    const d=document.getElementById("pdisp");
    const p=document.getElementById("ppad");
    "1234567890".split("").forEach(n=>{
        const b=document.createElement("button");
        b.textContent=n;
        b.onclick=()=>{
            playClick();
            input+=n;
            d.textContent=input;
            if(input==="112"){
                showText("경찰이 도착했다.\n\n하지만 그들은 한패였다.\n\n[사망]");
            }
            if(input==="3849"){
                showText("전화기 너머에서 낮은 웃음.\n\n장기 밀매 조직과 연결됐다.\n\n[히든 엔딩]");
            }
        };
        p.appendChild(b);
    });
}

start();
</script>
</body>
</html>
