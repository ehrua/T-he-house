<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>íƒˆì¶œ</title>
<style>
body{
background:#000;
color:#eee;
font-family:"Noto Serif KR",serif;
line-height:1.7;
}
#game{max-width:820px;margin:40px auto;padding:20px;}
.part{border-top:2px solid #333;margin-top:30px;padding-top:20px;}
button{
width:100%;padding:12px;margin:8px 0;
background:#111;color:#eee;border:1px solid #444;cursor:pointer;
}
button:hover{background:#222;}
button:disabled{opacity:.3;cursor:not-allowed;}
.keypad{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;}
.display{
background:#111;
padding:12px;
margin-bottom:10px;
text-align:center;
letter-spacing:6px;
font-size:20px;
}
.memo{color:#aaa;font-style:italic;}
h2{margin-top:0;}
.bar{width:100%;height:20px;background:#222;margin:15px 0;}
.fill{height:100%;background:#aaa;width:100%;transition:width .2s linear;}
</style>
</head>

<body>
<div id="game"></div>

<script>
/* ================== ì‚¬ìš´ë“œ ================== */
const bgm=new Audio("./sound/TheDread.mp3");
const chaseBgm=new Audio("./sound/Anxiety.mp3");
const hiddenBgm=new Audio("./sound/Symmetry.mp3");
const phoneKeySfx=new Audio("./sound/phone.mp3");
const phoneConnectSfx=new Audio("./sound/connect.mp3");
const leavesSfx=new Audio("./sound/fallenleaves.mp3");
const screamSfx=new Audio("./sound/screm2.mp3");

bgm.loop=chaseBgm.loop=hiddenBgm.loop=true;
bgm.volume=.7; chaseBgm.volume=.6; hiddenBgm.volume=.7;

/* ================== ìƒíƒœ ================== */
const game=document.getElementById("game");
const state={
tweezers:false,basementKey:false,safeKey:false,frontKey:false,
caught:0,deathReason:"",input:"",history:[],
hunterTimer:null, choiceTimer:null
};

/* ================== ë Œë” ================== */
function render(html,options=[],back=false){
clearTimeout(state.hunterTimer);
clearTimeout(state.choiceTimer);
game.innerHTML=html;

/* ğŸ”¥ ë‚©ì¹˜ë²” ë¹ˆë„ ì¦ê°€ */
if(Math.random()<0.45){
state.hunterTimer=setTimeout(()=>{
triggerHide();
},8000+Math.random()*6000);
}

if(back&&state.history.length){
const b=document.createElement("button");
b.innerText="ë’¤ë¡œ ê°€ê¸°";
b.onclick=()=>state.history.pop()();
game.appendChild(b);
}

options.forEach(o=>{
const btn=document.createElement("button");
btn.innerText=o.text;
btn.onclick=()=>{
state.history.push(()=>render(html,options,back));
o.action();
};
game.appendChild(btn);
});
}

/* ================== ìˆ¨ê¸° ì„ íƒ ================== */
function triggerHide(){
render(`
<h2>ê¸°ì²™ì´ ê°€ê¹Œì›Œì§„ë‹¤</h2>
<p>ìˆ¨ì„ ê³³ì„ ê³¨ë¼ì•¼ í•œë‹¤.</p>
`,[
{text:"í™”ì¥ì‹¤",action:()=>bathroom()},
{text:"ê±°ì‹¤",action:()=>livingHide()},
{text:"ì§€í•˜ì‹¤",action:()=>basementHide()}
]);

state.choiceTimer=setTimeout(()=>{
state.deathReason="ê²°ì •ì„ ë§ì„¤ì¸ ìˆœê°„, ì†ì´ ë‹¿ì•˜ë‹¤.";
death();
},5000);
}

/* ================== í™”ì¥ì‹¤ ================== */
function bathroom(){
render(`<h2>í™”ì¥ì‹¤</h2><p>í”¼ë¹„ë¦°ë‚´ê°€ ì§„ë™í•œë‹¤.</p>`,[
{text:"ë¬¸ ë’¤",action:()=>hideResult(0.7)},
{text:"ìš•ì¡°",action:()=>hideResult(0.4,true)}
]);
}

/* ================== ê±°ì‹¤ ================== */
function livingHide(){
render(`<h2>ê±°ì‹¤</h2><p>ìˆ¨ì„ ê³³ì´ ë§ì§€ ì•Šë‹¤.</p>`,[
{text:"ì†ŒíŒŒ ë’¤",action:()=>hideResult(0.5)},
{text:"ì»¤íŠ¼",action:()=>hideResult(0.3)}
]);
}

/* ================== ì§€í•˜ì‹¤ ================== */
function basementHide(){
render(`<h2>ì§€í•˜ì‹¤</h2><p>ì–´ë‘ ì´ ê¹Šë‹¤.</p>`,[
{text:"ê³„ë‹¨ ì•„ë˜",action:()=>hideResult(0.6)},
{text:"ì² ì œ ì„ ë°˜",action:()=>hideResult(0.2)}
]);
}

/* ================== ê²°ê³¼ ================== */
function hideResult(rate,bath=false){
if(Math.random()<rate){
render(`<p>ë°œì†Œë¦¬ê°€ ë©€ì–´ì§„ë‹¤...</p>`,[
{text:"ìˆ¨ì„ ê³ ë¥¸ë‹¤",action:room}
]);
}else{
state.deathReason=bath?
"ìš•ì¡° ì•ˆì—ì„œ ëˆˆì´ ë§ˆì£¼ì³¤ë‹¤.":
"ìˆ¨ì€ ê³³ì´ ë“¤ì¼°ë‹¤.";
death();
}
}

/* ================== PART 0 ================== */
function part0(){
render(`
<div class="part">
<h2>PART 0 : ìƒˆë²½ì˜ ê³µì›</h2>
<p>í½.<br>ë’¤í†µìˆ˜ì— ë‘”íƒí•œ ì¶©ê²©.</p>
</div>
`,[{text:"ëˆˆì„ ëœ¬ë‹¤",action:room}]);
}

/* ================== ë°© ================== */
function room(){
render(`
<div class="part">
<h2>ë°©</h2>
<p>ì‹ ë¬¸ì§€ë¡œ ë§‰íŒ ì°½ë¬¸. ì ê¸´ ë¬¸.</p>
</div>
`,[
{text:"ë¬¸",action:door},
{text:"ë°© ì¡°ì‚¬",action:searchRoom},
{text:"ê°€ë§Œíˆ",action:triggerHide}
]);
}

function searchRoom(){
render(`<p>ì¥ê¸° ë§¤ë§¤ ê¸°ë¡â€¦ ì´ë¦„: íŒíƒœí˜„</p>`,[
{text:"ì„œë",action:()=>{state.tweezers=true; render(`<p>í•€ì…‹ì„ ì–»ì—ˆë‹¤.</p>`,[{text:"ë¬¸",action:door}]);}},
{text:"ì¹¨ëŒ€ ë°‘",action:triggerHide}
],true);
}

function door(){
if(!state.tweezers){
render(`<p>ë¬¸ì´ ì ê²¨ ìˆë‹¤.</p>`,[{text:"ë’¤ë¡œ",action:room}]);
return;
}
render(`<p>ë¬¸ì´ ì—´ë¦°ë‹¤.</p>`,[{text:"ë°–ìœ¼ë¡œ",action:secondFloor}]);
}

/* ================== 2ì¸µ ================== */
function secondFloor(){
render(`<div class="part"><h2>2ì¸µ</h2></div>`,[
{text:"ì„œì¬",action:library},
{text:"ê³„ë‹¨",action:kitchen}
]);
}

function library(){
render(`
<div class="part"><h2>ì„œì¬</h2><p>ì‚¬ì§„ê³¼ í•´ë¶€í•™ ì±….</p></div>
`,[
{text:"ë©”ëª¨",action:()=>render(`<p class="memo">TVì˜ ìˆ«ìë¥¼ ê¸°ì–µí•´ë¼â€¦</p>`,[{text:"ë’¤ë¡œ",action:library}])},
{text:"ì„œë",action:()=>{state.basementKey=true; render(`<p>ì§€í•˜ì‹¤ ì—´ì‡  íšë“.</p>`,[{text:"ë’¤ë¡œ",action:library}]);}},
{text:"ë‚˜ê°„ë‹¤",action:secondFloor}
],true);
}

/* ================== ì£¼ë°© / ê±°ì‹¤ ================== */
function kitchen(){ render(`<h2>ì£¼ë°©</h2>`,[{text:"ê±°ì‹¤",action:livingroom}]); }

function livingroom(){
render(`<h2>ê±°ì‹¤</h2>`,[
{text:"TV",action:()=>render(`<p>TVì—” ì˜ë¯¸ ì—†ëŠ” ìˆ«ìë§Œ ë°˜ë³µëœë‹¤.</p>`,[{text:"ë’¤ë¡œ",action:livingroom}])},
{text:"ì§€í•˜ì‹¤",action:basement},
{text:"í˜„ê´€",action:frontDoor}
]);
}

/* ================== ì§€í•˜ì‹¤ ================== */
function basement(){
if(!state.basementKey){
render(`<p>ì ê²¨ ìˆë‹¤.</p>`,[{text:"ë’¤ë¡œ",action:livingroom}]);
return;
}
render(`<h2>ì§€í•˜ì‹¤</h2>`,[
{text:"ê¸ˆê³ ",action:()=>{state.frontKey=true; render(`<p>í˜„ê´€ ì—´ì‡  íšë“.</p>`,[{text:"ë’¤ë¡œ",action:basement}]);}},
{text:"ë‚˜ê°„ë‹¤",action:livingroom}
]);
}

/* ================== í˜„ê´€ ================== */
function frontDoor(){
state.input="";
drawKeypad("í˜„ê´€ ë„ì–´ë½");
}

function drawKeypad(title){
render(`<h2>${title}</h2><div class="display">${state.input}</div><div class="keypad" id="pad"></div>`);
const pad=document.getElementById("pad");
[1,2,3,4,5,6,7,8,9,0].forEach(n=>{
const b=document.createElement("button");
b.innerText=n;
b.onclick=()=>{state.input+=n; drawKeypad(title);};
pad.appendChild(b);
});
const ok=document.createElement("button");
ok.innerText="í™•ì¸";
ok.disabled=true; /* âŒ ë¹„í™œì„± */
pad.appendChild(ok);
}

/* ================== ì‚¬ë§ ================== */
function death(){
render(`<h2>ì‚¬ë§</h2><p>${state.deathReason}</p>`);
}

part0();
</script>
</body>
</html>
