<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>탈출</title>
<style>
body {
  background:#000;
  color:#eee;
  font-family: monospace;
  padding: 20px;
}
button {
  margin-top: 10px;
  padding: 8px 14px;
  background:#222;
  color:#eee;
  border:1px solid #555;
  cursor:pointer;
}
button:hover {
  background:#444;
}
#choices button {
  display:block;
}
</style>
</head>

<body>

<div id="text"></div>
<div id="choices"></div>

<audio id="footstep" src="footstep.mp3"></audio>

<script>
let state = "intro";
let hasPinset = false;
let choiceMade = false;
let deathTimer = null;

const text = document.getElementById("text");
const choices = document.getElementById("choices");
const footstep = document.getElementById("footstep");

function clearAll() {
  choices.innerHTML = "";
  choiceMade = false;
  if (deathTimer) {
    clearTimeout(deathTimer);
    deathTimer = null;
  }
}

function intro() {
  clearAll();
  text.innerHTML = `
여느 날과 같은 새벽이다.<br>
대인 기피증 때문에 사람이 없는 새벽에 강아지 산책을 나왔다.<br>
퍽— 소리와 함께 기억을 잃었다.
  `;
  addChoice("다음", wakeUp);
}

function wakeUp() {
  clearAll();
  text.innerHTML = `
눈을 떠보니 어느 집이다.<br>
창문은 모두 신문지와 나무 판자로 막혀 있다.
  `;
  addChoice("거실을 살핀다", noiseEvent);
}

function noiseEvent() {
  clearAll();
  text.innerHTML = `
인기척이 들린다.<br>
천천히, 발소리가 가까워진다…
  `;
  footstep.play();

  addChoice("주방으로 숨는다", death);
  addChoice("지하실로 숨는다", death);
  addChoice("화장실로 숨는다", bathroom);

  // 5초 안에 선택 안 하면 사망
  deathTimer = setTimeout(() => {
    if (!choiceMade) death();
  }, 5000);
}

function bathroom() {
  choiceMade = true;
  clearAll();
  text.innerHTML = `
화장실이다.<br>
숨을 곳을 골라야 한다.
  `;
  addChoice("욕조 안", surviveBathroom);
  addChoice("변기 뒤", death);
  addChoice("세면대 아래", death);
}

function surviveBathroom() {
  clearAll();
  text.innerHTML = `
욕조 안에 몸을 숨겼다.<br>
발소리는 지나간 것 같다…<br><br>
욕실 서랍에서 핀셋을 발견했다.
  `;
  hasPinset = true;
  addChoice("거실로 나온다", doorCheck);
}

function doorCheck() {
  clearAll();
  text.innerHTML = `
현관문이다.<br>
잠겨 있다.
  `;
  addChoice("문을 연다", () => {
    clearAll();
    text.innerHTML = `
문은 열리지 않는다.<br>
열쇠와 비밀번호가 필요해 보인다.
    `;
    addChoice("뒤로 돌아간다", wakeUp);
  });
}

function death() {
  clearAll();
  text.innerHTML = `
등 뒤에서 숨소리가 느껴진다.<br>
너무 늦었다.
  `;
}

function addChoice(label, func) {
  const btn = document.createElement("button");
  btn.textContent = label;
  btn.onclick = () => {
    choiceMade = true;
    func();
  };
  choices.appendChild(btn);
}

// 시작
intro();
</script>

</body>
</html>
