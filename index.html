<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>íƒˆì¶œ</title>
<style>
body{
background:#000;
color:#eee;
font-family:"Noto Serif KR",serif;
line-height:1.7;
}
#game{max-width:820px;margin:40px auto;padding:20px;}
.part{border-top:2px solid #333;margin-top:30px;padding-top:20px;}
button{
width:100%;padding:12px;margin:8px 0;
background:#111;color:#eee;border:1px solid #444;cursor:pointer;
}
button:hover{background:#222;}
.keypad{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;}
.display{
background:#111;
padding:12px;
margin-bottom:10px;
text-align:center;
letter-spacing:6px;
font-size:20px;
}
.memo{color:#aaa;font-style:italic;}
h2{margin-top:0;}
.bar{width:100%;height:20px;background:#222;margin:15px 0;}
.fill{height:100%;background:#aaa;width:100%;transition:width .2s linear;}
</style>
</head>

<body>
<div id="game"></div>

<script>
/* ================== ì‚¬ìš´ë“œ ================== */
const bgm=new Audio("./sound/TheDread.mp3");
const chaseBgm=new Audio("./sound/Anxiety.mp3");
const hiddenBgm=new Audio("./sound/Symmetry.mp3");

bgm.loop=chaseBgm.loop=hiddenBgm.loop=true;
bgm.volume=.7; chaseBgm.volume=.6; hiddenBgm.volume=.7;

let audioUnlocked=false;
function unlockAudio(){
if(audioUnlocked) return;
bgm.play().catch(()=>{});
audioUnlocked=true;
}
function playChase(){bgm.pause(); chaseBgm.currentTime=0; chaseBgm.play().catch(()=>{});}
function stopChase(){chaseBgm.pause(); bgm.play().catch(()=>{});}
function playHidden(){
bgm.pause(); chaseBgm.pause();
hiddenBgm.currentTime=0;
hiddenBgm.play().catch(()=>{});
}

/* ================== ìƒíƒœ ================== */
const game=document.getElementById("game");
const state={
tweezers:false,basementKey:false,safeKey:false,frontKey:false,
caught:0,deathReason:"",input:"",history:[],hunterTimer:null
};

/* ================== ë Œë” ================== */
function render(html,options=[],back=false){
clearTimeout(state.hunterTimer);
game.innerHTML=html;

/* ğŸ”¼ ë‚©ì¹˜ë²” ë¹ˆë„ ì¦ê°€ */
if(Math.random()<0.45){
state.hunterTimer=setTimeout(()=>{
playChase();
escapeChoice();
},10000+Math.random()*8000);
}

if(back&&state.history.length){
const b=document.createElement("button");
b.innerText="ë’¤ë¡œ ê°€ê¸°";
b.onclick=()=>state.history.pop()();
game.appendChild(b);
}

options.forEach(o=>{
const btn=document.createElement("button");
btn.innerText=o.text;
btn.onclick=()=>{
unlockAudio();
state.history.push(()=>render(html,options,back));
o.action();
};
game.appendChild(btn);
});
}

/* ================== ëœë¤ ë‚©ì¹˜ ================== */
function randomHunter(next){
if(Math.random()<0.3){
playChase();
escapeChoice();
}else next();
}

/* ================== ë„ë§ ì„ íƒ ================== */
function escapeChoice(){
let timer=setTimeout(()=>{
death("ë§ì„¤ì´ëŠ” ì‚¬ì´, ì†ì´ ë‹¿ì•˜ë‹¤.");
},5000);

render(`
<div class="part">
<h2>ê¸°ì²™</h2>
<p>ë’¤ì—ì„œ ìˆ¨ì†Œë¦¬ê°€ ê²¹ì¹œë‹¤.</p>
</div>
`,[
{text:"í™”ì¥ì‹¤",action:()=>{clearTimeout(timer); bathroom();}},
{text:"ê±°ì‹¤",action:()=>{clearTimeout(timer); hideChance("ê±°ì‹¤ ì†ŒíŒŒ ë’¤");}},
{text:"ì§€í•˜ì‹¤",action:()=>{clearTimeout(timer); hideChance("ê³„ë‹¨ ì•„ë˜");}}
]);
}

function bathroom(){
let timer=setTimeout(()=>{
death("ë¬¸ì„ ë‹«ê¸° ì „ì— ë“¤ì¼°ë‹¤.");
},5000);

render(`
<div class="part">
<h2>í™”ì¥ì‹¤</h2>
</div>
`,[
{text:"ë¬¸ ë’¤",action:()=>{clearTimeout(timer); hideChance("ë¬¸ ë’¤");}},
{text:"ìš•ì¡°",action:()=>{clearTimeout(timer); hideChance("í”¼ë¡œ ê°€ë“ ì°¬ ìš•ì¡°");}}
]);
}

function hideChance(place){
if(Math.random()<0.5){
stopChase();
render(`<p>${place}ì— ìˆ¨ì—ˆë‹¤â€¦ ì§€ë‚˜ê°„ë‹¤.</p>`,[{text:"ìˆ¨ì„ ê³ ë¥¸ë‹¤",action:secondFloor}]);
}else{
death(`${place}ì—ì„œ ë°œê²¬ëë‹¤.`);
}
}

/* ================== í˜„ê´€ ë¹„ë°€ë²ˆí˜¸ ìˆ˜ì • ================== */
function checkDoor(){
if(!state.frontKey){
render(`<p>ë¬¸ì´ ì—´ë¦¬ì§€ ì•ŠëŠ”ë‹¤.</p>`,[{text:"ë’¤ë¡œ",action:livingroom}]);
return;
}
if(state.input==="3849"){
render(`<p>ì•„ë¬´ ë°˜ì‘ì´ ì—†ë‹¤.</p>`,[{text:"ë’¤ë¡œ",action:livingroom}]);
}else{
state.deathReason="ê²½ë³´ìŒì´ ìš¸ë ¸ë‹¤.";
playChase(); death();
}
}

/* ================== ì‚¬ë§ ================== */
function death(reason){
clearTimeout(state.hunterTimer);
render(`<h2>ì‚¬ë§</h2><p>${reason}</p>`);
}

/* ===== ì´í•˜ ê¸°ì¡´ íë¦„ ê·¸ëŒ€ë¡œ ===== */
function part0(){
render(`<div class="part"><h2>PART 0 : ìƒˆë²½ì˜ ê³µì›</h2><p>í½.</p></div>`,
[{text:"ëˆˆì„ ëœ¬ë‹¤",action:room}]);
}
function room(){stopChase();render(`<h2>ë°©</h2>`,[
{text:"ë¬¸",action:door},{text:"ë°© ì¡°ì‚¬",action:searchRoom},{text:"ê°€ë§Œíˆ",action:()=>escapeChoice()}
]);}
function searchRoom(){render(`<p>ì¥ê¸° ë§¤ë§¤ ê¸°ë¡â€¦</p>`,[
{text:"ì„œë",action:()=>{state.tweezers=true; render(`<p>í•€ì…‹ íšë“</p>`,[{text:"ë¬¸",action:door}]);}}
]);}
function door(){if(!state.tweezers){render(`<p>ì ê²¨ ìˆë‹¤.</p>`,[{text:"ë’¤ë¡œ",action:room}]);return;}
render(`<p>ë¬¸ì´ ì—´ë¦°ë‹¤.</p>`,[{text:"ë°–ìœ¼ë¡œ",action:secondFloor}]);}
function secondFloor(){render(`<h2>2ì¸µ</h2>`,[
{text:"ì„œì¬",action:library},{text:"ê³„ë‹¨",action:kitchen}
]);}
function library(){render(`<h2>ì„œì¬</h2>`,[
{text:"ì„œë",action:()=>{state.basementKey=true; render(`<p>ì—´ì‡ </p>`,[{text:"ë’¤ë¡œ",action:library}]);}}
]);}
function kitchen(){render(`<h2>ì£¼ë°©</h2>`,[{text:"ê±°ì‹¤",action:livingroom}]);}
function livingroom(){render(`<h2>ê±°ì‹¤</h2>`,[
{text:"TV",action:()=>render(`<p>3849</p>`,[{text:"ë’¤ë¡œ",action:livingroom}])},
{text:"ì§€í•˜ì‹¤",action:basement},{text:"í˜„ê´€",action:frontDoor}
]);}
function basement(){if(!state.basementKey){render(`<p>ì ê²¨ ìˆë‹¤.</p>`,[{text:"ë’¤ë¡œ",action:livingroom}]);return;}
state.frontKey=true; render(`<p>í˜„ê´€ ì—´ì‡ </p>`,[{text:"ë’¤ë¡œ",action:livingroom}]);}
function frontDoor(){state.input=""; drawKeypad("í˜„ê´€ ë„ì–´ë½",checkDoor);}
function drawKeypad(title,callback){
render(`<h2>${title}</h2><div class="display">${state.input}</div><div class="keypad" id="pad"></div>`,[],true);
const pad=document.getElementById("pad");
[1,2,3,4,5,6,7,8,9,0].forEach(n=>{
const b=document.createElement("button");
b.innerText=n;
b.onclick=()=>{state.input+=n; drawKeypad(title,callback);};
pad.appendChild(b);
});
const ok=document.createElement("button");
ok.innerText="í™•ì¸";
ok.onclick=callback;
pad.appendChild(ok);
}

part0();
</script>
</body>
</html>
