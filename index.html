<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>숨을 죽여라</title>
<style>
body{
    background:#000;
    color:#eee;
    font-family:"Noto Serif KR",serif;
    text-align:center;
}
#wrap{
    max-width:600px;
    margin:60px auto;
}
button{
    width:100%;
    padding:14px;
    margin:10px 0;
    background:#111;
    color:#eee;
    border:1px solid #444;
    font-size:16px;
    cursor:pointer;
}
#barWrap{
    width:100%;
    height:22px;
    border:1px solid #555;
    margin-top:20px;
}
#bar{
    height:100%;
    width:100%;
    background:#b00;
    transition:width 0.1s linear;
}
#state{
    margin-top:20px;
    font-size:18px;
}
</style>
</head>

<body>
<div id="wrap">
    <h2>숨을 죽여라</h2>
    <p id="state">시작을 누르세요</p>

    <button id="startBtn">시작</button>
    <button id="holdBtn" disabled>숨 참기</button>

    <div id="barWrap"><div id="bar"></div></div>
</div>

<script>
/* ===== 오디오 ===== */
const leaves = new Audio("./sound/fallenleaves.mp3");
const scream = new Audio("./sound/screm2.mp3");
const bgm = new Audio("./sound/Symmetry.mp3");

leaves.volume = 0.9;
scream.volume = 1.0;
bgm.volume = 0.25;

/* ===== 상태 ===== */
let holding = false;
let gauge = 100;
let danger = false;
let mainLoop = null;

/* ===== 오디오 언락 ===== */
function unlockAudio(){
    [leaves, scream, bgm].forEach(a=>{
        a.play().then(()=>{
            a.pause();
            a.currentTime = 0;
        }).catch(()=>{});
    });
}

/* ===== 버튼 ===== */
const holdBtn = document.getElementById("holdBtn");
holdBtn.onmousedown = ()=>holding = true;
holdBtn.onmouseup = ()=>holding = false;
holdBtn.onmouseleave = ()=>holding = false;

document.getElementById("startBtn").onclick = ()=>{
    unlockAudio();
    bgm.play();
    holdBtn.disabled = false;
    startGame();
};

/* ===== 게임 시작 ===== */
function startGame(){
    mainLoop = setInterval(updateGauge, 50);
    cycleSound();
}

/* ===== 게이지 로직 ===== */
function updateGauge(){
    if(danger){
        if(holding){
            gauge -= 0.8;
        }else{
            gauge -= 2.2;
        }
    }else{
        if(!holding){
            gauge += 1.2;
        }else{
            gauge -= 0.5;
        }
    }

    gauge = Math.max(0, Math.min(100, gauge));
    document.getElementById("bar").style.width = gauge + "%";

    if(gauge <= 0){
        die();
    }
}

/* ===== 소리 사이클 ===== */
function cycleSound(){
    const safeTime = rand(2000, 5000);
    const dangerTime = rand(1200, 2500);

    // 정적
    danger = false;
    leaves.pause();
    document.getElementById("state").innerText = "……조용하다";

    setTimeout(()=>{
        // 위험
        danger = true;
        leaves.currentTime = 0;
        leaves.play();
        document.getElementById("state").innerText = "소리가 난다…";

        setTimeout(()=>{
            leaves.pause();
            cycleSound();
        }, dangerTime);

    }, safeTime);
}

/* ===== 사망 ===== */
function die(){
    clearInterval(mainLoop);
    leaves.pause();
    bgm.pause();
    scream.play();
    document.getElementById("state").innerText = "발각되었다";
}

/* ===== 유틸 ===== */
function rand(min,max){
    return Math.random()*(max-min)+min;
}
</script>
</body>
</html>
