<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ìˆ¨ ì°¸ê¸° í…ŒìŠ¤íŠ¸</title>
<style>
body{
    background:#000;
    color:#eee;
    font-family:"Noto Serif KR",serif;
    text-align:center;
}
#wrap{
    max-width:600px;
    margin:60px auto;
}
button{
    width:100%;
    padding:14px;
    margin:10px 0;
    background:#111;
    color:#eee;
    border:1px solid #444;
    font-size:16px;
    cursor:pointer;
}
button:hover{background:#222;}
#barWrap{
    width:100%;
    height:22px;
    border:1px solid #555;
    margin-top:20px;
}
#bar{
    height:100%;
    width:100%;
    background:#b00;
    transition:width 0.08s linear;
}
</style>
</head>

<body>
<div id="wrap">
    <h2>ìˆ¨ì„ ì£½ì—¬ë¼</h2>
    <p id="msg">ì‹œì‘ì„ ëˆŒëŸ¬ì•¼ ì†Œë¦¬ê°€ ë“¤ë¦°ë‹¤</p>

    <button id="startBtn">ì‹œì‘</button>
    <button id="holdBtn" disabled>ìˆ¨ ì°¸ê¸°</button>

    <div id="barWrap"><div id="bar"></div></div>
</div>

<script>
/* ================== ì˜¤ë””ì˜¤ ================== */
const leaves = new Audio("./fallenleaves.mp3"); // âœ… í™•ì¸
const scream = new Audio("./screm2.mp3");       // âœ… í™•ì¸
const bgm = new Audio("./sound/Symmetry.mp3");

leaves.loop = true;
bgm.loop = true;

leaves.volume = 0.9;
scream.volume = 1.0;
bgm.volume = 0.3; // ì´ êµ¬ê°„ë§Œ BGM ì‘ê²Œ

let audioUnlocked = false;

/* ğŸ”“ ë¸Œë¼ìš°ì € ìë™ì¬ìƒ ì°¨ë‹¨ í•´ì œ */
function unlockAudio(){
    if(audioUnlocked) return;

    [leaves, scream, bgm].forEach(a=>{
        a.play().then(()=>{
            a.pause();
            a.currentTime = 0;
        }).catch(()=>{});
    });

    audioUnlocked = true;
}

/* ================== ê²Œì„ ë¡œì§ ================== */
let holding = false;
let gauge = 100;
let loop = null;

document.getElementById("startBtn").onclick = ()=>{
    unlockAudio();      // ğŸ”¥ ì´ê²Œ ì—†ìœ¼ë©´ ì†Œë¦¬ ì•ˆ ë‚¨
    bgm.play();
    leaves.play();

    document.getElementById("msg").innerText =
        "ì†Œë¦¬ê°€ ë“¤ë¦¬ëŠ” ë™ì•ˆ ìˆ¨ì„ ì°¸ì•„ë¼";

    document.getElementById("holdBtn").disabled = false;
    startLoop();
};

const holdBtn = document.getElementById("holdBtn");
holdBtn.onmousedown = ()=>holding = true;
holdBtn.onmouseup = ()=>holding = false;
holdBtn.onmouseleave = ()=>holding = false;

function startLoop(){
    loop = setInterval(()=>{
        if(holding){
            gauge -= 0.9;
        }else{
            gauge += 0.6;
        }

        gauge = Math.max(0, Math.min(100, gauge));
        document.getElementById("bar").style.width = gauge + "%";

        if(gauge <= 0){
            clearInterval(loop);
            leaves.pause();
            scream.currentTime = 0;
            scream.play();
            document.getElementById("msg").innerText =
                "ìˆ¨ì„ ì°¸ì§€ ëª»í–ˆë‹¤";
        }
    },50);
}
</script>
</body>
</html>
