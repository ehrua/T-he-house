<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>íƒˆì¶œ</title>
<style>
body{
  background:#000;
  color:#eee;
  font-family:"Noto Serif KR",serif;
  line-height:1.7;
}
#game{max-width:820px;margin:40px auto;padding:20px;}
.part{border-top:2px solid #333;margin-top:30px;padding-top:20px;}
button{
  width:100%;padding:12px;margin:8px 0;
  background:#111;color:#eee;border:1px solid #444;cursor:pointer;
}
button:hover{background:#222;}
.keypad{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;}
.display{
  background:#111;
  padding:12px;
  margin-bottom:10px;
  text-align:center;
  letter-spacing:6px;
  font-size:20px;
}
.memo{color:#aaa;font-style:italic;}
h2{margin-top:0;}
</style>
</head>

<body>
<div id="game"></div>

<script>
/* ================== ì‚¬ìš´ë“œ ================== */
const bgm = new Audio("./sound/TheDread.mp3");
const chaseBgm = new Audio("./sound/Anxiety.mp3");
const hiddenBgm = new Audio("./sound/Symmetry.mp3"); // ğŸ”” íˆë“  ì—”ë”© ì „ìš©
const phoneKeySfx = new Audio("./sound/phone.mp3");
const phoneConnectSfx = new Audio("./sound/connect.mp3");

bgm.loop = true;
chaseBgm.loop = true;
hiddenBgm.loop = true;

bgm.volume = 0.7;
chaseBgm.volume = 0.6;
hiddenBgm.volume = 0.7;
phoneKeySfx.volume = 0.9;
phoneConnectSfx.volume = 0.9;

let audioUnlocked=false;
function unlockAudio(){
  if(audioUnlocked) return;
  bgm.play().catch(()=>{});
  audioUnlocked=true;
}

function playChase(){
  bgm.pause();
  chaseBgm.currentTime=0;
  chaseBgm.play().catch(()=>{});
}
function stopChase(){
  chaseBgm.pause();
  bgm.play().catch(()=>{});
}
function playHidden(){
  bgm.pause();
  chaseBgm.pause();
  hiddenBgm.currentTime=0;
  hiddenBgm.play().catch(()=>{});
}

/* ================== ìƒíƒœ ================== */
const game=document.getElementById("game");
const state={
  tweezers:false,
  basementKey:false,
  safeKey:false,
  frontKey:false,
  caught:0,
  deathReason:"",
  input:"",
  history:[],
  hunterTimer:null
};

/* ================== ë Œë” ================== */
function render(html,options=[],back=false){
  clearTimeout(state.hunterTimer);
  game.innerHTML=html;

  if(Math.random()<0.35){
    state.hunterTimer=setTimeout(()=>{
      state.deathReason="ë„ˆë¬´ ì˜¤ë˜ ë¨¸ë¬¼ë €ë‹¤. ë°œì†Œë¦¬ê°€ ë°”ë¡œ ë’¤ì—ì„œ ë©ˆì·„ë‹¤.";
      playChase();
      death();
    },12000+Math.random()*10000);
  }

  if(back && state.history.length){
    const b=document.createElement("button");
    b.innerText="ë’¤ë¡œ ê°€ê¸°";
    b.onclick=()=>state.history.pop()();
    game.appendChild(b);
  }

  options.forEach(o=>{
    const btn=document.createElement("button");
    btn.innerText=o.text;
    btn.onclick=()=>{
      unlockAudio();
      state.history.push(()=>render(html,options,back));
      o.action();
    };
    game.appendChild(btn);
  });
}

/* ================== ëœë¤ ë‚©ì¹˜ë²” ================== */
function randomHunter(next){
  if(Math.random()<0.25){
    state.caught++;
    state.deathReason="ìˆ¨ì„ ê³ ë¥´ëŠ” ìˆœê°„, ê¸°ì²™ì´ ë°”ë¡œ ë“± ë’¤ì— ìˆì—ˆë‹¤.";
    playChase();
    if(state.caught===1) basementCaptured();
    else death();
  }else next();
}

/* ================== ì‹œì‘ ================== */
function part0(){
render(`
<div class="part">
<h2>PART 0 : ìƒˆë²½ì˜ ê³µì›</h2>
<p>í½.<br>ë’¤í†µìˆ˜ì˜ ì¶©ê²©.</p>
</div>
`,[{text:"ëˆˆì„ ëœ¬ë‹¤",action:room}]);
}

/* ================== ë°© ================== */
function room(){
stopChase();
render(`
<div class="part">
<h2>ë°©</h2>
<p>ì‹ ë¬¸ì§€ë¡œ ë§‰íŒ ì°½ë¬¸. ì ê¸´ ë¬¸.</p>
</div>
`,[
{text:"ë¬¸",action:door},
{text:"ë°© ì¡°ì‚¬",action:searchRoom},
{text:"ê°€ë§Œíˆ",action:wait}
]);
}

function searchRoom(){
render(`<p>ì¥ê¸° ë§¤ë§¤ ê¸°ë¡â€¦ ì´ë¦„: íŒíƒœí˜„</p>`,[
{text:"ì„œë",action:getTweezers},
{text:"ì¹¨ëŒ€ ë°‘",action:()=>{
  state.deathReason="ì‹œì²´ë¥¼ ê±´ë“œë¦¬ëŠ” ìˆœê°„ ë°”ë‹¥ì´ ì‚ê±±ì˜€ë‹¤.";
  randomHunter(room);
}}
],true);
}

function getTweezers(){
state.tweezers=true;
render(`<p>í•€ì…‹ì„ ì–»ì—ˆë‹¤.</p>`,[{text:"ë¬¸",action:door}]);
}

function door(){
if(!state.tweezers){
render(`<p>ë¬¸ì´ ì ê²¨ ìˆë‹¤.</p>`,[{text:"ë’¤ë¡œ",action:room}]);
return;
}
render(`<p>ë¬¸ì´ ì—´ë¦°ë‹¤.</p>`,[{text:"ë°–ìœ¼ë¡œ",action:secondFloor}]);
}

function wait(){
state.caught++;
state.deathReason="ì•„ë¬´ê²ƒë„ í•˜ì§€ ì•ŠëŠ” ì„ íƒì´ ê°€ì¥ ìœ„í—˜í–ˆë‹¤.";
playChase();
if(state.caught===1) basementCaptured();
else death();
}

/* ================== 2ì¸µ ================== */
function secondFloor(){
stopChase();
render(`<div class="part"><h2>2ì¸µ</h2></div>`,[
{text:"ì„œì¬",action:()=>randomHunter(library)},
{text:"ê³„ë‹¨",action:kitchen}
]);
}

function library(){
render(`
<div class="part">
<h2>ì„œì¬</h2>
<p>ì‚¬ì§„ê³¼ í•´ë¶€í•™ ì±….</p>
</div>
`,[
{text:"ë©”ëª¨",action:memo},
{text:"ì„œë",action:getBasementKey},
{text:"ë‚˜ê°„ë‹¤",action:()=>randomHunter(secondFloor)}
],true);
}

function memo(){
render(`<p class="memo">TVì˜ ìˆ«ìë¥¼ ê¸°ì–µí•´ë¼. 3849</p>`,[{text:"ë’¤ë¡œ",action:library}]);
}

function getBasementKey(){
state.basementKey=true;
render(`<p>ì§€í•˜ì‹¤ ì—´ì‡  íšë“.</p>`,[{text:"ë’¤ë¡œ",action:library}]);
}

/* ================== ë‚©ì¹˜ ================== */
function basementCaptured(){
playChase();
render(`
<div class="part">
<h2>ì§€í•˜ì‹¤</h2>
<p>ë¶™ì¡í˜€ ëŒë ¤ì™”ë‹¤.</p>
</div>
`,[{text:"ë²„í‹´ë‹¤",action:secondFloor}]);
}

/* ================== ì£¼ë°© / í™”ì¥ì‹¤ ================== */
function kitchen(){
render(`
<div class="part">
<h2>ì£¼ë°©</h2>
<p>ì§‘ì´ ìˆ¨ì„ ì£½ì¸ ê²ƒ ê°™ë‹¤.</p>
</div>
`,[
{text:"í™”ì¥ì‹¤",action:()=>randomHunter(bathroom)},
{text:"ê±°ì‹¤",action:()=>randomHunter(livingroom)}
]);
}

function bathroom(){
render(`<div class="part"><h2>í™”ì¥ì‹¤</h2></div>`,[
{text:"ë¬¸ ë’¤",action:()=>randomHunter(livingroom)},
{text:"ë³€ê¸° ë’¤",action:()=>randomHunter(livingroom)},
{text:"ìš•ì¡°",action:()=>randomHunter(livingroom)}
]);
}

/* ================== ê±°ì‹¤ ================== */
function livingroom(){
stopChase();
render(`
<div class="part">
<h2>ê±°ì‹¤</h2>
</div>
`,[
{text:"TV",action:tv},
{text:"ì„œë",action:livingDrawer},
{text:"ì§€í•˜ì‹¤",action:basement},
{text:"í˜„ê´€",action:frontDoor}
]);
}

function tv(){
render(`<p>TVì— 3849ê°€ ë°˜ë³µëœë‹¤.</p>`,[{text:"ë’¤ë¡œ",action:livingroom}]);
}

function livingDrawer(){
state.safeKey=true;
render(`<p>ê¸ˆê³  ì—´ì‡  íšë“.</p>`,[{text:"ë’¤ë¡œ",action:livingroom}]);
}

/* ================== ì§€í•˜ì‹¤ ================== */
function basement(){
if(!state.basementKey){
render(`<p>ì ê²¨ ìˆë‹¤.</p>`,[{text:"ë’¤ë¡œ",action:livingroom}]);
return;
}
render(`
<div class="part">
<h2>ì§€í•˜ì‹¤</h2>
</div>
`,[
{text:"ê¸ˆê³ ",action:basementSafe},
{text:"ë‚˜ê°„ë‹¤",action:basementFreeMove}
]);
}

function basementSafe(){
if(!state.safeKey){
render(`<p>ê¸ˆê³ ëŠ” ì ê²¨ ìˆë‹¤.</p>`,[{text:"ë’¤ë¡œ",action:basement}]);
return;
}
state.frontKey=true;
render(`
<p>
ê¸ˆê³  ì•ˆì— ì‘ì€ ì—´ì‡ .<br>
<i>í˜„ê´€ ì—´ì‡ ë‹¤.</i>
</p>
`,[{text:"ë’¤ë¡œ",action:basement}]);
}

function basementFreeMove(){
render(`<p>ì´ë™</p>`,[
{text:"2ì¸µ",action:()=>randomHunter(secondFloor)},
{text:"ì£¼ë°©",action:()=>randomHunter(kitchen)},
{text:"ê±°ì‹¤",action:()=>randomHunter(livingroom)},
{text:"í˜„ê´€",action:frontDoor}
],true);
}

/* ================== í˜„ê´€ ================== */
function frontDoor(){
state.input="";
drawFrontDoor();
}

function drawFrontDoor(){
render(`
<h2>í˜„ê´€ ë„ì–´ë½</h2>
<div class="display">${state.input}</div>
<div class="keypad" id="pad"></div>
`,[],true);

const pad=document.getElementById("pad");
[1,2,3,4,5,6,7,8,9,0].forEach(n=>{
  const b=document.createElement("button");
  b.innerText=n;
  b.onclick=()=>{state.input+=n;drawFrontDoor();};
  pad.appendChild(b);
});
const ok=document.createElement("button");
ok.innerText="í™•ì¸";
ok.onclick=checkDoor;
pad.appendChild(ok);
}

function checkDoor(){
if(!state.frontKey){
state.deathReason="ë„ì–´ë½ì€ ë°˜ì‘ì´ ì—†ë‹¤.";
death();
return;
}
if(state.input==="3849") outside();
else{
state.deathReason="ê²½ë³´ìŒê³¼ í•¨ê»˜ ë°œì†Œë¦¬ê°€ í„°ì ¸ ë‚˜ì™”ë‹¤.";
playChase();
death();
}
}

/* ================== ë°”ê¹¥ ================== */
function outside(){
stopChase();
render(`
<div class="part">
<h2>ë°–</h2>
<p>ì°¨ê°€ìš´ ê³µê¸°.<br>ê³¨ëª© ëì— ê³µì¤‘ì „í™”ê°€ ìˆë‹¤.</p>
<p class="memo">ì „í™”ê¸° ì•„ë˜ ë‚¡ì€ ë©”ëª¨: 3849</p>
</div>
`,[{text:"ê³µì¤‘ì „í™”",action:payphone}]);
}

/* ================== ê³µì¤‘ì „í™” ================== */
function payphone(){
state.input="";
drawPayphone();
}

function drawPayphone(){
render(`
<h2>ê³µì¤‘ì „í™”</h2>
<div class="display">${state.input}</div>
<div class="keypad" id="pad"></div>
`,[],true);

const pad=document.getElementById("pad");
[1,2,3,4,5,6,7,8,9,0].forEach(n=>{
  const b=document.createElement("button");
  b.innerText=n;
  b.onclick=()=>{
    phoneKeySfx.currentTime=0;
    phoneKeySfx.play();
    state.input+=n;
    drawPayphone();
  };
  pad.appendChild(b);
});

const ok=document.createElement("button");
ok.innerText="í†µí™”";
ok.onclick=callPhone;
pad.appendChild(ok);
}

function callPhone(){
phoneConnectSfx.currentTime=0;
phoneConnectSfx.play();

setTimeout(()=>{
  if(state.input==="112"){
    playHidden();
    render(`<h2>íˆë“  ì—”ë”© : ì‚¬ì´ë Œ</h2>`);
  }
  else if(state.input==="3849"){
    render(`<h2>íˆë“  ì—”ë”© : ê±°ë˜</h2>`);
  }
  else{
    state.deathReason="ì‹ í˜¸ìŒì´ ëŠê¸°ê³  ë’¤ì—ì„œ ìˆ¨ì†Œë¦¬ê°€ ê²¹ì³¤ë‹¤.";
    death();
  }
},2000);
}

/* ================== ì‚¬ë§ ================== */
function death(){
clearTimeout(state.hunterTimer);
render(`<h2>ì‚¬ë§</h2><p>${state.deathReason}</p>`);
}

part0();
</script>
</body>
</html>
