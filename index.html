<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>탈출</title>
<style>
body{
background:#000;
color:#eee;
font-family:monospace;
padding:20px;
}
#game{
max-width:700px;
margin:auto;
}
button{
margin:5px;
padding:8px 14px;
background:#111;
color:#eee;
border:1px solid #555;
cursor:pointer;
}
button:hover{
background:#333;
}
input{
background:#000;
color:#0f0;
border:1px solid #555;
padding:5px;
text-align:center;
font-size:18px;
width:120px;
}
.ui{
margin-top:10px;
}
</style>
</head>
<body>
<div id="game"></div>

<script>
const game=document.getElementById("game");

const state={
caught:0,
basementKey:false,
safeKey:false,
frontKey:false
};

function render(text,choices=[]){
game.innerHTML=text;
choices.forEach(c=>{
const b=document.createElement("button");
b.innerText=c.text;
b.onclick=c.action;
game.appendChild(b);
});
}

/* ---------- 시작 ---------- */
render(`<p>눈을 뜨자 낡은 집 안이다.</p>`,[
{text:"방을 조사한다",action:room}
]);

/* ---------- 공통 잡힘 ---------- */
function caught(){
state.caught++;
if(state.caught>=3){
render(`<p>
그는 더 이상 참지 않는다.<br>
이번엔 확실히 죽는다.
</p>`);
return;
}
render(`<p>
붙잡혔다.<br>
정신을 차리고 보니 지하실이다.
</p>`,[
{text:"일어난다",action:basement}
]);
}

/* ---------- 방 ---------- */
function room(){
render(`<p>작은 방이다.</p>`,[
{text:"문을 연다",action:hall},
{text:"숨어본다",action:caught}
]);
}

/* ---------- 복도 ---------- */
function hall(){
render(`<p>복도다.</p>`,[
{text:"거실",action:livingroom},
{text:"현관",action:frontdoor}
]);
}

/* ---------- 거실 ---------- */
function livingroom(){
render(`<p>
거실이다.<br>
서랍, TV, 지하실 문이 있다.
</p>`,[
{text:"서랍",action:drawer},
{text:"TV",action:tv},
{text:"지하실",action:basement}
]);
}

function drawer(){
if(state.safeKey){
render(`<p>서랍은 비어 있다.</p>`,[
{text:"뒤로",action:livingroom}
]);
return;
}
state.safeKey=true;
render(`<p>
서랍 안에서 <b>금고 열쇠</b>를 얻었다.
</p>`,[
{text:"뒤로",action:livingroom}
]);
}

function tv(){
render(`<p>
TV 화면에 숫자가 깜빡인다.<br>
<b>4017</b>
</p>`,[
{text:"뒤로",action:livingroom}
]);
}

/* ---------- 지하실 ---------- */
function basement(){
render(`<p>
축축한 지하실이다.<br>
금고와 문이 보인다.
</p>`,[
{text:"금고",action:safe},
{text:"복도",action:hall}
]);
}

function safe(){
if(!state.safeKey){
render(`<p>금고는 열리지 않는다.</p>`,[
{text:"뒤로",action:basement}
]);
return;
}
state.frontKey=true;
render(`<p>
금고 안에 <b>현관 열쇠</b>가 있다.
</p>`,[
{text:"뒤로",action:basement}
]);
}

/* ---------- 현관 ---------- */
let code="";
function frontdoor(){
if(!state.frontKey){
render(`<p>현관은 잠겨 있다.</p>`,[
{text:"뒤로",action:hall}
]);
return;
}
render(`
<p>번호를 입력하라</p>
<input id="code" readonly value="">
<div class="ui">
${[1,2,3,4,5,6,7,8,9,0].map(n=>`<button onclick="press(${n})">${n}</button>`).join("")}
<button onclick="enter()">확인</button>
</div>
`);
}

function press(n){
code+=n;
document.getElementById("code").value=code;
}

function enter(){
if(code==="4017"){
escape();
}else{
code="";
document.getElementById("code").value="";
caught();
}
}

/* ---------- 탈출 ---------- */
function escape(){
render(`<p>
밖으로 나왔다.<br>
공중전화가 보인다.
</p>`,[
{text:"전화한다",action:phone},
{text:"그냥 떠난다",action:ending}
]);
}

/* ---------- 전화 ---------- */
let phoneNum="";
function phone(){
render(`
<p>번호를 누르시오</p>
<input id="phone" readonly value="">
<div class="ui">
${[1,2,3,4,5,6,7,8,9,0].map(n=>`<button onclick="phonePress(${n})">${n}</button>`).join("")}
<button onclick="call()">통화</button>
</div>
`);
}

function phonePress(n){
phoneNum+=n;
document.getElementById("phone").value=phoneNum;
}

function call(){
render(`<p>
수화기 너머에서 숨소리가 들린다.<br>
"왜 돌아봤지?"
</p>`);
}

function ending(){
render(`<p>
아무 일도 없었다.<br>
…정말로?
</p>`);
}
</script>
</body>
</html>
