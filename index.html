<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>íƒˆì¶œ</title>

<style>
body{
  background:#000;
  color:#eee;
  font-family:"Noto Serif KR",serif;
  line-height:1.7;
}
#game{max-width:820px;margin:40px auto;padding:20px;}
.part{border-top:2px solid #333;margin-top:30px;padding-top:20px;}
button{
  width:100%;padding:12px;margin:8px 0;
  background:#111;color:#eee;border:1px solid #444;cursor:pointer;
}
button:hover{background:#222;}
.keypad{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;}
.display{
  background:#111;
  padding:12px;
  margin-bottom:10px;
  text-align:center;
  letter-spacing:6px;
  font-size:20px;
}
.memo{color:#aaa;font-style:italic;}
</style>
</head>

<body>
<div id="game"></div>

<script>
/* ================= ì‚¬ìš´ë“œ ================= */
const audio = {
  bgm: new Audio("./sound/TheDread.mp3"),
  chase: new Audio("./sound/Anxiety.mp3"),
  phone: new Audio("./sound/phone.mp3")
};

audio.bgm.loop = true;
audio.chase.loop = true;
audio.bgm.volume = 0.7;
audio.chase.volume = 0.55;
audio.phone.volume = 0.8;

let audioUnlocked = false;

function unlockAudio(){
  if(audioUnlocked) return;
  audio.bgm.play().catch(()=>{});
  audioUnlocked = true;
}

/* ================= ê²Œì„ ìƒíƒœ ================= */
const game=document.getElementById("game");
const state={
  tweezers:false,
  basementKey:false,
  safeKey:false,
  frontKey:false,
  input:"",
  hunterTimer:null
};

/* ================= ê³µí†µ ë Œë” ================= */
function render(html,options=[]){
  clearTimeout(state.hunterTimer);
  game.innerHTML = html;

  options.forEach(o=>{
    const b=document.createElement("button");
    b.innerText=o.text;
    b.onclick=()=>{
      unlockAudio();   // ğŸ”¥ ëª¨ë“  ë²„íŠ¼ í´ë¦­ ì‹œ BGM í—ˆìš©
      o.action();
    };
    game.appendChild(b);
  });
}

/* ================= ì‹œì‘ ================= */
function part0(){
  render(`
  <div class="part">
    <h2>PART 0 : ìƒˆë²½ì˜ ê³µì›</h2>
    <p>í½. ë’¤í†µìˆ˜ì˜ ì¶©ê²©.</p>
  </div>
  `,[{text:"ëˆˆì„ ëœ¬ë‹¤",action:room}]);
}

/* ================= ë°© ================= */
function room(){
  audio.bgm.play().catch(()=>{});
  render(`
  <div class="part">
    <h2>ë°©</h2>
    <p>ì‹ ë¬¸ì§€ë¡œ ë§‰íŒ ì°½ë¬¸. ì ê¸´ ë¬¸.</p>
  </div>
  `,[
    {text:"ì„œë",action:()=>{
      state.tweezers=true;
      room();
    }},
    {text:"ë¬¸",action:door}
  ]);
}

function door(){
  if(!state.tweezers){
    render(`<p>ë¬¸ì´ ì ê²¨ ìˆë‹¤.</p>`,[{text:"ë’¤ë¡œ",action:room}]);
    return;
  }
  render(`<p>ë¬¸ì´ ì—´ë¦°ë‹¤.</p>`,[{text:"ë°–ìœ¼ë¡œ",action:secondFloor}]);
}

/* ================= 2ì¸µ ================= */
function secondFloor(){
  render(`
  <div class="part"><h2>2ì¸µ</h2></div>
  `,[
    {text:"ì„œì¬",action:library},
    {text:"ê³„ë‹¨",action:livingroom}
  ]);
}

function library(){
  render(`
  <div class="part">
    <h2>ì„œì¬</h2>
    <p class="memo">TVì˜ ìˆ«ìë¥¼ ê¸°ì–µí•´ë¼. 3849</p>
  </div>
  `,[{text:"ì—´ì‡ ",action:()=>{
    state.basementKey=true;
    secondFloor();
  }}]);
}

/* ================= ê±°ì‹¤ ================= */
function livingroom(){
  render(`
  <div class="part"><h2>ê±°ì‹¤</h2></div>
  `,[
    {text:"TV",action:()=>render(`<p>3849</p>`,[{text:"ë’¤ë¡œ",action:livingroom}])},
    {text:"ì§€í•˜ì‹¤",action:basement},
    {text:"í˜„ê´€",action:frontDoor}
  ]);
}

/* ================= ì§€í•˜ì‹¤ ================= */
function basement(){
  if(!state.basementKey){
    render(`<p>ì ê²¨ ìˆë‹¤.</p>`,[{text:"ë’¤ë¡œ",action:livingroom}]);
    return;
  }
  render(`
  <p>ê¸ˆê³  ì•ˆì— ì‘ì€ ì—´ì‡ .<br><i>í˜„ê´€ ì—´ì‡ ë‹¤.</i></p>
  `,[{text:"ë‚˜ê°„ë‹¤",action:()=>{
    state.frontKey=true;
    livingroom();
  }}]);
}

/* ================= í˜„ê´€ ================= */
function frontDoor(){
  state.input="";
  drawKeypad("í˜„ê´€ ë„ì–´ë½",checkDoor);
}

function checkDoor(){
  if(state.input==="3849" && state.frontKey){
    outside();
  }else{
    render(`<h2>ì‚¬ë§</h2><p>ê²½ë³´ìŒê³¼ í•¨ê»˜ ëë‚¬ë‹¤.</p>`);
  }
}

/* ================= ë°”ê¹¥ ================= */
function outside(){
  render(`
  <div class="part">
    <h2>ë°–</h2>
    <p>ê³µì¤‘ì „í™”ê°€ ìˆë‹¤.</p>
    <p class="memo">3849</p>
  </div>
  `,[{text:"ê³µì¤‘ì „í™”",action:payphone}]);
}

/* ================= ê³µì¤‘ì „í™” ================= */
function payphone(){
  state.input="";
  drawKeypad("ê³µì¤‘ì „í™”",callPhone);
}

function callPhone(){
  audio.phone.currentTime=0;
  audio.phone.play();

  if(state.input==="112"){
    audio.bgm.pause();
    audio.chase.pause();
    render(`<h2>íˆë“  ì—”ë”© : ì‚¬ì´ë Œ</h2>`);
  }
  else if(state.input==="3849"){
    audio.bgm.pause();
    audio.chase.pause();
    render(`<h2>íˆë“  ì—”ë”© : ê±°ë˜</h2>`);
  }
  else{
    render(`<h2>ì‚¬ë§</h2><p>ì˜ëª»ëœ ë²ˆí˜¸.</p>`);
  }
}

/* ================= í‚¤íŒ¨ë“œ ê³µí†µ ================= */
function drawKeypad(title,confirm){
  render(`
    <h2>${title}</h2>
    <div class="display">${state.input}</div>
    <div class="keypad" id="pad"></div>
  `);

  const pad=document.getElementById("pad");
  [1,2,3,4,5,6,7,8,9,0].forEach(n=>{
    const b=document.createElement("button");
    b.innerText=n;
    b.onclick=()=>{state.input+=n;drawKeypad(title,confirm);};
    pad.appendChild(b);
  });

  const ok=document.createElement("button");
  ok.innerText="í™•ì¸";
  ok.onclick=confirm;
  pad.appendChild(ok);
}

/* ================= ì‹œì‘ ================= */
part0();
</script>
</body>
</html>
