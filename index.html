<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>탈출</title>
<style>
body{
background:#000;
color:#eee;
font-family:"Noto Serif KR",serif;
line-height:1.7;
}
#game{max-width:820px;margin:40px auto;padding:20px;}
.part{border-top:2px solid #333;margin-top:30px;padding-top:20px;}
button{
width:100%;padding:12px;margin:8px 0;
background:#111;color:#eee;border:1px solid #444;cursor:pointer;
}
button:hover{background:#222;}
.keypad{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;}
.display{
background:#111;
padding:12px;
margin-bottom:10px;
text-align:center;
letter-spacing:6px;
font-size:20px;
}
.memo{color:#aaa;font-style:italic;}
h2{margin-top:0;}
</style>
</head>

<body>
<div id="game"></div>

<script>
/* ================== 사운드 ================== */
const bgm=new Audio("./sound/TheDread.mp3");
const chaseBgm=new Audio("./sound/Anxiety.mp3");
bgm.loop=chaseBgm.loop=true;
bgm.volume=.7; chaseBgm.volume=.6;

/* ================== 상태 ================== */
const game=document.getElementById("game");
const state={
tweezers:false,basementKey:false,safeKey:false,frontKey:false,
input:"",escapeTimer:null
};

function render(html,options=[]){
clearTimeout(state.escapeTimer);
game.innerHTML=html;
options.forEach(o=>{
const b=document.createElement("button");
b.innerText=o.text;
b.onclick=o.action;
game.appendChild(b);
});
}

/* ================== 납치 이벤트 (강화) ================== */
function hunterEncounter(success){
chaseBgm.currentTime=0;
chaseBgm.play().catch(()=>{});

render(`
<div class="part">
<p>발소리가 바로 뒤까지 다가온다.</p>
<p>숨을 곳을 골라야 한다.</p>
</div>
`,[
{text:"화장실",action:()=>bathroom(success)},
{text:"거실",action:()=>hideSimple(success,"거실 소파 뒤")},
{text:"지하실",action:()=>hideSimple(success,"지하실 계단 밑")}
]);

state.escapeTimer=setTimeout(()=>{
death("망설인 사이, 손이 닿았다.");
},5000);
}

function hideSimple(success,place){
clearTimeout(state.escapeTimer);
if(Math.random()<0.7){
success();
}else{
death(`${place}에서 발견되었다.`);
}
}

/* ================== 화장실 ================== */
function bathroom(success){
render(`
<div class="part">
<h2>화장실</h2>
<p>피 냄새가 코를 찌른다.</p>
</div>
`,[
{text:"문 뒤",action:()=>{
clearTimeout(state.escapeTimer);
Math.random()<0.6?success():death("문이 열렸다.");
}},
{text:"욕조",action:()=>{
clearTimeout(state.escapeTimer);
Math.random()<0.4?success():death("시체 더미가 움직였다.");
}}
]);
}

/* ================== 랜덤 헌터 ================== */
function randomHunter(next){
if(Math.random()<0.4){
hunterEncounter(next);
}else next();
}

/* ================== 시작 ================== */
function part0(){
bgm.play().catch(()=>{});
render(`
<div class="part">
<h2>새벽</h2>
<p>눈을 떴다.</p>
</div>
`,[{text:"일어난다",action:room}]);
}

/* ================== 방 ================== */
function room(){
render(`
<div class="part">
<h2>방</h2>
</div>
`,[
{text:"문",action:door},
{text:"조사",action:()=>randomHunter(room)}
]);
}

function door(){
render(`<p>문이 열린다.</p>`,[{text:"밖으로",action:frontDoor}]);
}

/* ================== 현관 ================== */
function frontDoor(){
state.input="";
drawKeypad();
}

function drawKeypad(){
render(`
<h2>현관 도어락</h2>
<div class="display">${state.input}</div>
<div class="keypad" id="pad"></div>
`,[]);
const pad=document.getElementById("pad");
[1,2,3,4,5,6,7,8,9,0].forEach(n=>{
const b=document.createElement("button");
b.innerText=n;
b.onclick=()=>{state.input+=n; drawKeypad();};
pad.appendChild(b);
});
const ok=document.createElement("button");
ok.innerText="확인";
ok.onclick=checkDoor;
pad.appendChild(ok);
}

function checkDoor(){
if(state.input==="3849"){
outside();
}else{
death("경보음이 울렸다.");
}
}

/* ================== 바깥 ================== */
function outside(){
render(`
<div class="part">
<h2>밖</h2>
<p>공중전화가 보인다.</p>
</div>
`,[{text:"공중전화",action:()=>render(`<h2>엔딩 페이지로 이동</h2>`)}]);
}

/* ================== 사망 ================== */
function death(reason){
render(`<h2>사망</h2><p>${reason}</p>`);
}

part0();
</script>
</body>
</html>
