<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ê¸°ì–µì´ ëŠê¸´ ë°¤</title>

<style>
body {
    background: #000;
    color: #eee;
    font-family: "Noto Sans KR", sans-serif;
    max-width: 720px;
    margin: auto;
    padding: 24px;
}
h1 {
    color: #b30000;
    margin-bottom: 20px;
}
#story {
    white-space: pre-line;
    line-height: 1.7;
    font-size: 17px;
}
button {
    display: block;
    width: 100%;
    margin-top: 12px;
    padding: 14px;
    background: #111;
    color: #eee;
    border: 1px solid #444;
    font-size: 16px;
    cursor: pointer;
}
button:hover {
    background: #222;
}
</style>
</head>

<body>

<h1 id="title">íƒˆì¶œ</h1>
<div id="story"></div>
<div id="next"></div>
<div id="choices"></div>

<!-- ğŸµ ì˜¤ë””ì˜¤ -->
<audio id="bgmFlood" src="flood.mp3"></audio>
<audio id="bgmAlone" src="alone.mp3"></audio>
<audio id="bgmChase" src="out_of_flux.mp3"></audio>
<audio id="sfxPhone" src="phone.mp3"></audio>

<script>
const story = document.getElementById("story");
const nextArea = document.getElementById("next");
const choices = document.getElementById("choices");

const flood = document.getElementById("bgmFlood");
const alone = document.getElementById("bgmAlone");
const chase = document.getElementById("bgmChase");
const phone = document.getElementById("sfxPhone");

let currentBgm = null;
let bgmTimer = null;

function stopAllBgm() {
    [flood, alone, chase].forEach(bgm => {
        bgm.pause();
        bgm.currentTime = 0;
    });
    if (bgmTimer) clearTimeout(bgmTimer);
}

function playBgm(bgm, duration = 8000, volume = 0.4) {
    stopAllBgm();
    currentBgm = bgm;
    bgm.volume = volume;
    bgm.play();
    bgmTimer = setTimeout(() => {
        bgm.pause();
    }, duration);
}

function setText(text) {
    story.textContent = text;
    nextArea.innerHTML = "";
    choices.innerHTML = "";
}

function showNext(callback) {
    const btn = document.createElement("button");
    btn.textContent = "ë‹¤ìŒìœ¼ë¡œ";
    btn.onclick = () => {
        nextArea.innerHTML = "";
        callback();
    };
    nextArea.appendChild(btn);
}

function addChoice(text, action) {
    const btn = document.createElement("button");
    btn.textContent = text;
    btn.onclick = action;
    choices.appendChild(btn);
}

/* â–¶ ì‹œì‘ */
function intro() {
    setText(
`ì˜¤ì „ 1ì‹œ.
ì•¼ì‹¬í•œ ìƒˆë²½ì´ì—ˆë‹¤.

ê°•ì•„ì§€ì™€ ì‚°ì±…ì„ í•˜ê³  ìˆì—ˆë‹¤.
ê³µì›ì—ëŠ” ë‚˜ ë§ê³  ì•„ë¬´ë„ ì—†ì—ˆë‹¤.

ê·¸ ë‹¤ìŒ ê¸°ì–µì€ ì—†ë‹¤.`
    );

    showNext(intro2);
}

function intro2() {
    playBgm(flood, 7000, 0.35);

    setText(
`ëˆˆì„ ëœ¬ë‹¤.

ì²œì¥ì´ ë³´ì¸ë‹¤.
ëª¨ë¥´ëŠ” ì§‘ì´ë‹¤.

ëª¸ì´ ë¬´ê²ë‹¤.
ì†ëª©ì´ ìš±ì‹ ê±°ë¦°ë‹¤.`
    );

    showNext(firstRoom);
}

function firstRoom() {
    setText(
`ì§‘ ì•ˆì€ ì¡°ìš©í•˜ë‹¤.
ë„ˆë¬´ ì¡°ìš©í•˜ë‹¤.

ì–´ë””ì„ ê°€ ì¸ê¸°ì²™ì´ ë“¤ë¦° ê²ƒ ê°™ê¸°ë„ í•˜ë‹¤.`
    );

    showNext(() => {
        addChoice("ë°©ì„ ë‚˜ê°„ë‹¤", hallway);
        addChoice("ì ì‹œ ìˆ¨ì„ ê³ ë¥¸ë‹¤", aloneMoment);
    });
}

function aloneMoment() {
    playBgm(alone, 6000, 0.4);

    setText(
`ìˆ¨ì„ ê³ ë¥¸ë‹¤.

ê°•ì•„ì§€ëŠ” ì—†ë‹¤.
ëª©ì¤„ë„ ì—†ë‹¤.

ì´ìƒí•˜ë‹¤.`
    );

    showNext(firstRoom);
}

function hallway() {
    playBgm(flood, 5000, 0.3);

    setText(
`ë³µë„ë‹¤.

ë°”ë‹¥ì´ ì‚ê±±ì¸ë‹¤.
ì´ ì§‘ì— í˜¼ìê°€ ì•„ë‹ˆë¼ëŠ” ìƒê°ì´ ë“ ë‹¤.`
    );

    showNext(hideChoice);
}

function hideChoice() {
    setText(
`ê°‘ìê¸° ë°œì†Œë¦¬ê°€ ë“¤ë¦°ë‹¤.
ê°€ê¹Œì›Œì§€ê³  ìˆë‹¤.

ì–´ë”” ìˆ¨ì„ê¹Œ?`
    );

    addChoice("ìš•ì‹¤ë¡œ ë“¤ì–´ê°„ë‹¤", bathroom);
    addChoice("ê·¸ëŒ€ë¡œ ì„œ ìˆëŠ”ë‹¤", caught);
}

function bathroom() {
    stopAllBgm();

    setText(
`ìš•ì‹¤ì´ë‹¤.
ìˆ¨ì„ ê³³ì´ ëª‡ êµ°ë° ë³´ì¸ë‹¤.`
    );

    showNext(() => {
        addChoice("ìš•ì¡° ì•ˆì— ìˆ¨ëŠ”ë‹¤", bathtub);
        addChoice("ë³€ê¸° ë’¤", caught);
        addChoice("ì„¸ë©´ëŒ€ ì•„ë˜", caught);
    });
}

function bathtub() {
    stopAllBgm();

    setText(
`ì»¤íŠ¼ì„ ë‹«ê³  ìš•ì¡° ì•ˆì— ëª¸ì„ ìˆ¨ê¸´ë‹¤.

ë°œì†Œë¦¬ê°€ ë©ˆì¶˜ë‹¤.
ì ì‹œ í›„, ë©€ì–´ì§„ë‹¤.`
    );

    showNext(() => {
        setText(
`ì¡°ì‹¬ìŠ¤ëŸ½ê²Œ ìš•ì‹¤ì„ ë‚˜ì˜¨ë‹¤.

ë¬¸ ì•ì—â€”
ê·¸ê°€ ì„œ ìˆë‹¤.`
        );
        playBgm(chase, 6000, 0.5);
        showNext(caught);
    });
}

function caught() {
    stopAllBgm();

    setText(
`ì‹œì•¼ê°€ í”ë“¤ë¦°ë‹¤.

ë„ë§ì¹  í‹ˆì€ ì—†ë‹¤.`
    );

    showNext(endPolice);
}

function endPolice() {
    stopAllBgm();

    setText(
`ëˆˆì„ ëœ¨ë‹ˆ ì „í™”ê¸°ê°€ ì•ì— ìˆë‹¤.

ê²½ì°°ì— ì‹ ê³ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`
    );

    addChoice("ì‹ ê³ í•œë‹¤", () => {
        phone.play();
        setTimeout(() => {
            setText(
`ì „í™”ê¸° ë„ˆë¨¸ì—ì„œ
ë‚®ì€ ì›ƒìŒì†Œë¦¬ê°€ ë“¤ë¦°ë‹¤.

ì—”ë”©: ê³µë²”`
            );
        }, 3000);
    });

    addChoice("ì‹ ê³ í•˜ì§€ ì•ŠëŠ”ë‹¤", () => {
        setText(
`ë°–ì´ë‹¤.
ê³µì›ì´ë‹¤.

ê°•ì•„ì§€ë¥¼ ì‚°ì±…ì‹œí‚¤ë˜ ê¸°ì–µì´ ëŒì•„ì˜¨ë‹¤.

ì—”ë”©: ì§„ì‹¤`
        );
    });
}

intro();
</script>

</body>
</html>
