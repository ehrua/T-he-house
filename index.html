<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>저주받은 집</title>
<style>
body {
  background:#000;
  color:#eee;
  font-family: "Malgun Gothic", sans-serif;
  text-align:center;
}
button {
  margin:6px;
  padding:10px 18px;
  background:#222;
  color:#eee;
  border:1px solid #555;
  cursor:pointer;
}
button:hover { background:#444; }
#log { margin-top:20px; min-height:120px; }
input {
  padding:8px;
  background:#111;
  color:#eee;
  border:1px solid #555;
}
</style>
</head>
<body>

<h1>저주받은 집</h1>
<div id="log"></div>
<div id="choices"></div>

<script>
let state = {
  place: "거실",
  hasSafeKey: false,
  hasBasementKey: true,
  dead: false
};

function randomKidnapper() {
  return Math.random() < 0.2;
}

function die(reason) {
  document.getElementById("log").innerHTML =
    `<h2>사망</h2><p>이유: ${reason}</p>`;
  document.getElementById("choices").innerHTML =
    `<button onclick="location.reload()">다시 시작</button>`;
}

function render(text, buttons) {
  if (state.dead) return;
  document.getElementById("log").innerHTML = `<p>${text}</p>`;
  let html = "";
  buttons.forEach(b => {
    html += `<button onclick="${b.action}">${b.label}</button>`;
  });
  document.getElementById("choices").innerHTML = html;
}

/* ===== 거실 ===== */
function livingRoom() {
  state.place = "거실";
  render(
    "거실이다. 조용하지만 불안하다.",
    [
      { label:"서랍을 조사한다", action:"drawer()" },
      { label:"주방으로 간다", action:"kitchen()" },
      { label:"지하실로 간다", action:"basement()" }
    ]
  );
}

function drawer() {
  if (!state.hasSafeKey) {
    state.hasSafeKey = true;
    render("서랍 안에서 금고 열쇠를 발견했다.", [
      { label:"거실로 돌아간다", action:"livingRoom()" }
    ]);
  } else {
    render("이미 비어 있다.", [
      { label:"거실로 돌아간다", action:"livingRoom()" }
    ]);
  }
}

/* ===== 주방 ===== */
function kitchen() {
  state.place = "주방";
  if (randomKidnapper()) {
    render(
      "뒤에서 발소리가 들린다! 도망쳐야 한다!",
      [
        { label:"화장실로 도망간다", action:"bathroomHide()" }
      ]
    );
    return;
  }
  render("주방이다. 냉기가 감돈다.", [
    { label:"거실로 간다", action:"livingRoom()" }
  ]);
}

/* ===== 화장실 숨기 ===== */
function bathroomHide() {
  render(
    "화장실에 숨었다. 어디에 숨을까?",
    [
      { label:"문 뒤", action:"hideSuccess()" },
      { label:"변기 뒤", action:"hideSuccess()" },
      { label:"욕조 안", action:"hideSuccess()" }
    ]
  );
}

function hideSuccess() {
  render(
    "숨는 데 성공했다. 인기척이 사라진다.",
    [
      { label:"거실로 돌아간다", action:"livingRoom()" }
    ]
  );
}

/* ===== 지하실 ===== */
function basement() {
  state.place = "지하실";
  render(
    "지하실이다. 습하고 어둡다.",
    [
      { label:"금고를 조사한다", action:"safe()" },
      { label:"나간다", action:"freeMove()" }
    ]
  );
}

function safe() {
  if (!state.hasSafeKey) {
    render("금고는 잠겨 있다. 열쇠가 필요하다.", [
      { label:"뒤로 간다", action:"basement()" }
    ]);
    return;
  }
  render(
    "금고에 비밀번호 입력 장치가 있다.",
    [
      { label:"비밀번호 입력", action:"passwordInput()" },
      { label:"뒤로 간다", action:"basement()" }
    ]
  );
}

function passwordInput() {
  document.getElementById("log").innerHTML =
    `<p>비밀번호를 입력하라</p><input id="pw"><br>`;
  document.getElementById("choices").innerHTML =
    `<button onclick="checkPW()">확인</button>`;
}

function checkPW() {
  const pw = document.getElementById("pw").value;
  if (pw === "1974") {
    render("금고가 열렸다. 탈출 단서다.", [
      { label:"지하실로 돌아간다", action:"basement()" }
    ]);
  } else {
    die("잘못된 비밀번호를 입력했다");
  }
}

/* ===== 자유 이동 ===== */
function freeMove() {
  if (randomKidnapper()) {
    render(
      "납치범에게 붙잡혔다!",
      [
        { label:"저항한다", action:"die('저항 중 살해당했다')" },
        { label:"끌려간다", action:"basement()" }
      ]
    );
    return;
  }
  render(
    "집 안을 자유롭게 이동할 수 있다.",
    [
      { label:"뒤로가기", action:"basement()" },
      { label:"2층", action:"die('2층에서 추락했다')" },
      { label:"화장실", action:"bathroomHide()" },
      { label:"거실", action:"livingRoom()" },
      { label:"주방", action:"kitchen()" },
      { label:"현관", action:"phoneBooth()" }
    ]
  );
}

/* ===== 공중전화 ===== */
function phoneBooth() {
  render(
    "현관 앞 공중전화 박스가 있다.",
    [
      { label:"전화를 건다", action:"die('수화기 너머에서 무언가가 나왔다')" },
      { label:"돌아간다", action:"freeMove()" }
    ]
  );
}

/* 시작 */
livingRoom();
</script>

</body>
</html>
