<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>탈출 – 1층</title>
<style>
body {
  background:#0b0b0b;
  color:#eee;
  font-family:"Noto Sans KR", sans-serif;
  padding:20px;
}
#game { max-width:760px; margin:auto; }
button {
  display:block;
  width:100%;
  margin:6px 0;
  padding:10px;
  background:#1a1a1a;
  color:#eee;
  border:1px solid #444;
  cursor:pointer;
}
button:hover { background:#2a2a2a; }
</style>
</head>
<body>
<div id="game">
  <p id="text"></p>
  <div id="choices"></div>
</div>

<script>
const text = document.getElementById("text");
const choices = document.getElementById("choices");

const state = {
  caughtOnce:false,
  basementKey:false,
  safeKey:false,
  frontPassword:false,
  axe:false
};

function clear() { choices.innerHTML=""; }
function add(t,f){ const b=document.createElement("button"); b.textContent=t; b.onclick=f; choices.appendChild(b); }

/* ===== 1층 시작 ===== */

function floor1Start(){
text.textContent =
"아래층에 내려오자 인기척이 들리는 것 같다.";
clear();
add("싱크대 아래 숨는다", sinkHide);
add("식탁 아래 숨는다", tableHide);
add("도망친다", runAway);
}

/* ===== 숨기 ===== */

function sinkHide(){
text.textContent =
"저벅… 저벅… 발소리가 점점 가까워진다.\n내가 숨은 곳 바로 앞에 멈춰 섰다.\n그가 문을 연다.";
clear();
death();
}

function tableHide(){
text.textContent =
"식탁 아래에 몸을 숨기자 웃는 소리가 들린다.";
clear();
add("도망간다", runAway);
add("맞선다", death);
}

/* ===== 도망 ===== */

function runAway(){
text.textContent="숨을 참은 채 도망쳤다. 어디로 갈까?";
clear();
add("화장실", bathroom);
add("2층", upstairs);
add("거실", living);
}

/* ===== 화장실 ===== */

function bathroom(){
text.textContent =
"발소리가 화장실로 가까워진다.";
clear();
add("문 뒤에 숨는다", bathroomDoor);
add("변기 뒤에 숨는다", bathroomToilet);
add("욕조에 숨는다", bathtub);
}

function bathroomDoor(){
text.textContent =
"아무도 없자 그는 이내 돌아갔다.\n겨우 따돌렸다.";
safeMove();
}

function bathroomToilet(){
text.textContent =
"그가 나를 붙잡아 끌고 갔다.\n눈을 떠보니 지하실이다.";
state.caughtOnce=true;
basementWake();
}

function bathtub(){
text.textContent =
"욕조 안에는 피가 가득하다.";
clear();
add("안으로 들어간다", bathtubIn);
add("다른 곳에 숨는다", death);
}

function bathtubIn(){
text.textContent =
"문이 열리는 소리가 났다.\n찾는 듯하더니 문을 닫고 사라졌다.";
safeMove();
}

/* ===== 자유 이동 ===== */

function safeMove(){
clear();
add("주방", kitchen);
add("2층", upstairs);
add("거실", living);
add("지하실", basementCheck);
}

/* ===== 주방 ===== */

function kitchen(){
text.textContent="주방이다. 어디를 뒤질까?";
clear();
add("냉장고", ()=>simple("별게 없다.", kitchen));
add("전자레인지", microwave);
add("싱크대", ()=>simple("안에 별다른 건 없다.\n숨기에는 좋아 보인다.", kitchen));
}

function microwave(){
if(!state.basementKey){
  state.basementKey=true;
  text.textContent="전자레인지 안에서 열쇠를 발견했다.\n(지하실 열쇠)";
}else{
  text.textContent="이미 비어 있다.";
}
clear();
add("돌아간다", kitchen);
}

/* ===== 거실 ===== */

function living(){
text.textContent="거실이다. 서랍, 옷장, TV가 있다.";
clear();
add("서랍", drawer);
add("옷장", ()=>simple("안에는 아무것도 없다.\n숨기엔 좋아 보인다.", living));
add("TV", tv);
}

function drawer(){
if(!state.safeKey){
  state.safeKey=true;
  text.textContent="서랍에서 열쇠를 얻었다.\n'금고 열쇠'라고 적혀 있다.";
}else{
  text.textContent="이미 비어 있다.";
}
clear();
add("돌아간다", living);
}

function tv(){
state.frontPassword=true;
text.textContent =
"TV에서는 예능 프로그램이 나오고 있다.\n정답은 3849라고 한다.\n혹시… 현관 비밀번호?";
clear();
add("돌아간다", living);
}

/* ===== 2층 ===== */

function upstairs(){
text.textContent =
"그를 발견했다.\n하지만 그는 나를 아직 눈치채지 못한 모양이다.";
clear();
add("주방", kitchen);
add("거실", living);
add("지하실", basementCheck);
}

/* ===== 지하실 ===== */

function basementCheck(){
if(!state.basementKey){
text.textContent =
"지하실 문은 잠겨 있다.\n서재에서 얻었던 열쇠가 떠오른다.";
clear();
add("돌아간다", safeMove);
}else{
basement();
}
}

function basement(){
text.textContent =
"지하실은 생각보다 어둡지 않다.\n곳곳에 곰덫이 깔려 있다.";
clear();
add("문", ()=>simple("이게 나가는 문인가?", basement));
add("선반", shelf);
add("금고", safeBox);
}

function shelf(){
if(!state.caughtOnce && !state.axe){
state.axe=true;
text.textContent="선반에서 도끼를 발견했다.";
}else{
text.textContent="비어 있다.";
}
clear();
add("돌아간다", basement);
}

function safeBox(){
if(state.safeKey){
text.textContent="금고 안에서 현관 열쇠를 얻었다.";
}else{
text.textContent="열쇠가 필요하다.";
}
clear();
add("돌아간다", basement);
}

/* ===== 기타 ===== */

function basementWake(){
text.textContent =
"문이 잠겨 있다.\n핀셋으로 문을 열고 빠져나왔다.\n그는 도끼를 들고 있다.\n지하실 탈출은 물 건너갔다.";
clear();
safeMove();
}

function simple(msg,back){
text.textContent=msg;
clear();
add("돌아간다", back);
}

function death(){
clear();
add("사망", ()=>text.textContent="사망…");
}

/* 시작 */
floor1Start();
</script>
</body>
</html>
