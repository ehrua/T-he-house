<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>탈출</title>
<style>
body{
  background:#000;
  color:#eee;
  font-family:"Noto Serif KR",serif;
  line-height:1.7;
}
#game{
  max-width:820px;
  margin:40px auto;
  padding:20px;
}
.part{
  border-top:2px solid #333;
  margin-top:30px;
  padding-top:20px;
}
button{
  width:100%;
  padding:12px;
  margin:10px 0;
  background:#111;
  color:#eee;
  border:1px solid #444;
  cursor:pointer;
}
button:hover{background:#222;}
h2{margin-top:0;}
</style>
</head>
<body>
<div id="game"></div>

<script>
const game=document.getElementById("game");

const state={
  tweezers:false,
  basementKey:false,
  safeKey:false,
  frontKey:false,
  caught:0,
  history:[]
};

/* ===== 공통 렌더 ===== */
function render(text,options=[],back=false){
  game.innerHTML=text;

  if(back && state.history.length){
    const b=document.createElement("button");
    b.innerText="뒤로 가기";
    b.onclick=()=>state.history.pop()();
    game.appendChild(b);
  }

  options.forEach(o=>{
    const btn=document.createElement("button");
    btn.innerText=o.text;
    btn.onclick=()=>{
      state.history.push(()=>render(text,options,back));
      o.action();
    };
    game.appendChild(btn);
  });
}

/* ===== 랜덤 납치범 ===== */
function randomHunter(next){
  if(Math.random()<0.25){
    state.caught++;
    if(state.caught===1){
      basementCaptured();
    }else{
      death();
    }
  }else{
    next();
  }
}

/* ================= PART 0 ================= */
function part0(){
render(`
<div class="part">
<h2>PART 0 : 새벽의 공원</h2>
<p>
사람이 없는 새벽, 강아지와 산책 중이었다.<br>
강아지가 멈춰 섰다.<br><br>
퍽.<br><br>
뒤통수의 충격과 함께 시야가 끊겼다.
</p>
</div>
`,[{text:"눈을 뜬다",action:room}]);
}

/* ================= PART 1 ================= */
function room(){
render(`
<div class="part">
<h2>PART 1 : 방</h2>
<p>
신문지로 막힌 창문.<br>
잠긴 문.<br>
여긴 탈출해야 한다.
</p>
</div>
`,[
{text:"문으로 간다",action:door},
{text:"방을 살핀다",action:searchRoom},
{text:"가만히 있는다",action:wait}
]);
}

function searchRoom(){
render(`
<p>
장기 매매 기록이다.<br>
이름: 판태현.<br>
목적은 명확하다.
</p>
`,[
{text:"서랍",action:getTweezers},
{text:"침대 밑",action:corpse}
],true);
}

function corpse(){
render(`<p>이미 실패한 사람의 흔적이다.</p>`,[
{text:"뒤로",action:searchRoom}
]);
}

function getTweezers(){
state.tweezers=true;
render(`<p>핀셋을 얻었다.</p>`,[
{text:"문으로 간다",action:door}
]);
}

function door(){
if(!state.tweezers){
render(`<p>문이 잠겨 있다.</p>`,[
{text:"뒤로",action:room}
]);
return;
}
render(`<p>핀셋으로 문을 열었다.</p>`,[
{text:"밖으로",action:secondFloor}
]);
}

function wait(){
state.caught++;
if(state.caught===1){
basementCaptured();
}else{
death();
}
}

/* ================= PART 2 ================= */
function secondFloor(){
render(`
<div class="part">
<h2>PART 2 : 2층</h2>
<p>
집 안은 고요하다.<br>
하지만 오래 머물 수는 없다.
</p>
</div>
`,[
{text:"서재",action:()=>randomHunter(library)},
{text:"계단으로 내려간다",action:()=>randomHunter(kitchen)}
]);
}

function library(){
render(`
<div class="part">
<h2>서재</h2>
<p>해부학 책과 사진.</p>
</div>
`,[
{text:"메모를 읽는다",action:memo},
{text:"서랍을 뒤진다",action:getBasementKey},
{text:"나간다",action:()=>randomHunter(secondFloor)}
],true);
}

function memo(){
render(`<p><i>
탈출은 두 갈래.<br>
현관은 비밀번호와 열쇠.<br>
지하실은 위험하지만 기회다.<br><br>
그는 두 번은 용서하지 않는다.
</i></p>`,[
{text:"뒤로",action:library}
]);
}

function getBasementKey(){
state.basementKey=true;
render(`<p>지하실 열쇠를 얻었다.</p>`,[
{text:"뒤로",action:library}
]);
}

/* ================= 납치 ================= */
function basementCaptured(){
render(`
<div class="part">
<h2>지하실</h2>
<p>
눈을 뜨니 지하실이다.<br>
이번엔 도끼다.
</p>
</div>
`,[
{text:"버틴다",action:secondFloor}
]);
}

/* ================= 주방 ================= */
function kitchen(){
render(`
<div class="part">
<h2>PART 3 : 주방</h2>
<p>
냉장고의 모터 소리.<br>
뒤에서 발소리가 난다.
</p>
</div>
`,[
{text:"싱크대 아래",action:()=>randomHunter(secondFloor)},
{text:"식탁 뒤",action:()=>randomHunter(livingroom)},
{text:"화장실",action:()=>randomHunter(bathroom)}
]);
}

/* ================= 화장실 ================= */
function bathroom(){
render(`
<div class="part">
<h2>화장실</h2>
<p>
숨을 곳이 없다.
</p>
</div>
`,[
{text:"나간다",action:()=>randomHunter(livingroom)}
]);
}

/* ================= 거실 ================= */
function livingroom(){
render(`
<div class="part">
<h2>PART 4 : 거실</h2>
<p>
여긴 갈림길이다.
</p>
</div>
`,[
{text:"TV",action:tv},
{text:"서랍",action:livingDrawer},
{text:"지하실",action:basement}
]);
}

function tv(){
render(`<p>TV에서 숫자 3849가 반복된다.</p>`,[
{text:"뒤로",action:livingroom}
]);
}

function livingDrawer(){
state.safeKey=true;
render(`<p>서랍에서 금고 열쇠를 얻었다.</p>`,[
{text:"뒤로",action:livingroom}
]);
}

/* ================= 지하실 ================= */
function basement(){
if(!state.basementKey){
render(`<p>지하실은 잠겨 있다.</p>`,[
{text:"뒤로",action:livingroom}
]);
return;
}
render(`
<div class="part">
<h2>PART 5 : 지하실</h2>
<p>
금고와 판자로 막힌 출구.
</p>
</div>
`,[
{text:"금고",action:safe},
{text:"판자를 조사한다",action:basementEscape},
{text:"나간다",action:basementFreeMove}
]);
}

function basementFreeMove(){
render(`
<p>어디로 갈 것인가?</p>
`,[
{text:"2층",action:()=>randomHunter(secondFloor)},
{text:"화장실",action:()=>randomHunter(bathroom)},
{text:"서재",action:()=>randomHunter(library)},
{text:"거실",action:()=>randomHunter(livingroom)}
],true);
}

function safe(){
if(!state.safeKey){
render(`<p>금고는 열리지 않는다.</p>`,[
{text:"뒤로",action:basement}
]);
return;
}
state.frontKey=true;
render(`<p>현관 열쇠를 얻었다.</p>`,[
{text:"뒤로",action:basement}
]);
}

function basementEscape(){
if(state.caught>0 || !state.frontKey){
render(`<p>조건이 맞지 않는다.</p>`,[
{text:"뒤로",action:basement}
]);
return;
}
render(`
<h2>지하실 탈출 엔딩</h2>
<p>
판자를 부쉈다.<br>
차가운 공기가 들어온다.<br>
살아남았다.
</p>
`);
}

function death(){
render(`<h2>사망</h2><p>두 번째 실수는 끝이다.</p>`);
}

part0();
</script>
</body>
</html>
