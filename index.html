<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>나폴리탄 괴담 테스트</title>
<style>
  body {
    background: #000;
    color: #eee;
    font-family: "Noto Serif KR", serif;
    padding: 20px;
  }
  #text {
    white-space: pre-line;
    margin-bottom: 20px;
    line-height: 1.7;
  }
  .choice {
    display: block;
    margin: 6px 0;
    padding: 8px;
    background: #111;
    border: 1px solid #444;
    color: #eee;
    cursor: pointer;
  }
  .choice:hover {
    background: #222;
  }
  .disabled {
    opacity: 0.4;
    pointer-events: none;
  }
</style>
</head>
<body>

<div id="text"></div>
<div id="choices"></div>

<script>
/* ===== 상태 관리 ===== */
let state = {
  room: "bedroom",
  hasTweezers: false,
  drawerChecked: false,
  backEnabled: false,
  history: []
};

/* ===== 공통 렌더 ===== */
function render(text, choices, allowBack = false) {
  const textBox = document.getElementById("text");
  const choiceBox = document.getElementById("choices");

  textBox.textContent = text;
  choiceBox.innerHTML = "";

  if (allowBack && state.history.length > 0) {
    const backBtn = document.createElement("button");
    backBtn.textContent = "뒤로 가기";
    backBtn.className = "choice";
    backBtn.onclick = goBack;
    choiceBox.appendChild(backBtn);
  }

  choices.forEach(c => {
    const btn = document.createElement("button");
    btn.textContent = c.label;
    btn.className = "choice";
    btn.onclick = c.action;
    choiceBox.appendChild(btn);
  });
}

function saveState() {
  state.history.push(JSON.stringify(state));
}

function goBack() {
  const prev = state.history.pop();
  if (!prev) return;
  state = JSON.parse(prev);
  scenes[state.room]();
}

/* ===== 씬 정의 ===== */
const scenes = {

  bedroom() {
    state.room = "bedroom";
    render(
`눈을 뜨자 낡은 방 천장이 보인다.
공기가 지나치게 고요하다.
이 방에서 너무 오래 머무르는 건 좋지 않을 것 같다.`,
    [
      { label: "방을 살핀다", action: () => { saveState(); scenes.bedroomSearch(); }},
      { label: "대기한다", action: () => {
        render("아무 일도 일어나지 않는다.\n…이 선택은 의미가 없는 것 같다.", [
          { label: "다시 생각한다", action: scenes.bedroom }
        ]);
      }}
    ]
    );
  },

  bedroomSearch() {
    state.room = "bedroomSearch";
    render(
`방 안에는 침대, 옷장, 그리고 낡은 서랍이 있다.`,
    [
      { label: "서랍을 뒤진다", action: () => { saveState(); scenes.drawer(); }},
      { label: "옷장을 연다", action: () => { saveState(); scenes.closet(); }},
      { label: "문으로 간다", action: () => { saveState(); scenes.leaveRoom(); }}
    ],
    true
    );
  },

  drawer() {
    state.room = "drawer";
    if (!state.hasTweezers) {
      state.hasTweezers = true;
      render(
`서랍 안쪽 깊숙한 곳에서 핀셋을 발견했다.
왜 이런 물건이 여기에 있는지는 모르겠지만,
가지고 가는 편이 좋을 것 같다.`,
      [
        { label: "뒤로", action: scenes.bedroomSearch }
      ]
      );
    } else {
      render(
`이미 서랍은 뒤져봤다.
안에는 아무것도 없다.`,
      [
        { label: "뒤로", action: scenes.bedroomSearch }
      ]
      );
    }
  },

  closet() {
    state.room = "closet";
    render(
`옷장 안은 비어 있다.
하지만 안쪽 벽면에 긁힌 자국이 남아 있다.
안에서 무언가 숨을 쉬었던 것 같은 느낌이 든다.`,
    [
      { label: "조용히 물러난다", action: scenes.bedroomSearch }
    ],
    true
    );
  },

  leaveRoom() {
    state.room = "hallway";
    render(
`문을 열고 밖으로 나가자,
어둠 속에서 미세한 인기척이 느껴진다.

지금 당장 움직이면
들킬 것 같은 예감이 든다.`,
    [
      { label: "숨죽이며 기다린다", action: () => { saveState(); scenes.study(); }}
    ]
    );
  },

  study() {
    state.room = "study";
    render(
`서재에 도착했다.
책장에는 오래된 책들이 빼곡히 꽂혀 있다.
이곳도 안전해 보이진 않는다.`,
    [
      { label: "책들을 뒤진다", action: () => {
        render(
`책들 사이에서 쓸모 있어 보이는 메모를 발견했지만,
지금은 의미를 알 수 없다.`,
        [{ label: "돌아선다", action: scenes.study }]
        );
      }},
      { label: "서랍을 뒤진다", action: () => {
        render(
`서랍 안에는 지하로 내려가는 문에 대한 기록이 적혀 있다.
지금은 테스트 중이라 열쇠 없이도 열릴 것 같다.`,
        [{ label: "문으로 간다", action: scenes.kitchen }]
        );
      }},
      { label: "밖으로 나간다", action: scenes.leaveRoom }
    ],
    true
    );
  },

  kitchen() {
    state.room = "kitchen";
    render(
`주방에 도착했다.
다음 파트로 이어질 준비가 된 것 같다.`,
    [
      { label: "테스트 종료", action: () => {
        render("여기까지가 현재 테스트 범위다.", []);
      }}
    ],
    true
    );
  }

};

/* ===== 시작 ===== */
scenes.bedroom();
</script>

</body>
</html>
