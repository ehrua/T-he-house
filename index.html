<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>탈출 시뮬레이션</title>
<style>
  body {
    background:#000;
    color:#eee;
    font-family: monospace;
    padding:20px;
  }
  button {
    display:block;
    margin:8px 0;
    padding:8px 12px;
    background:#111;
    color:#eee;
    border:1px solid #555;
    cursor:pointer;
  }
  button:hover {
    background:#222;
  }
</style>
</head>
<body>

<div id="text"></div>
<div id="choices"></div>

<script>
let state = {
  location: "basement",
  hasSafeKey: false,
  hasBasementKey: true,
  kidnapperChance: true
};

function render(text, options) {
  document.getElementById("text").innerHTML = "<p>" + text + "</p>";
  const c = document.getElementById("choices");
  c.innerHTML = "";
  options.forEach(o => {
    const b = document.createElement("button");
    b.textContent = o.label;
    b.onclick = o.action;
    c.appendChild(b);
  });
}

function randomKidnapper(onCatch) {
  if (!state.kidnapperChance) return false;
  if (Math.random() < 0.25) {
    render(
      "발소리가 멈췄다. 너무 늦었다.\n납치범에게 붙잡혔다…",
      [{
        label:"눈을 뜬다",
        action: () => {
          state.location = "basement";
          basement();
        }
      }]
    );
    return true;
  }
  return false;
}

/* === 장소들 === */

function basement() {
  state.location = "basement";
  render(
    "어두운 지하실이다. 계단 위로 나갈 수 있다.",
    [
      { label:"계단으로 올라간다", action: exitBasement }
    ]
  );
}

function exitBasement() {
  state.location = "hall";
  hallFromBasement();
}

/* ★ 여기서 수정됨: 서재 제거 / 주방, 현관 추가 */
function hallFromBasement() {
  if (randomKidnapper()) return;
  render(
    "지하실을 빠져나왔다. 집 안을 자유롭게 이동할 수 있다.",
    [
      { label:"뒤로가기(지하실)", action: basement },
      { label:"2층으로 간다", action: secondFloor },
      { label:"화장실로 간다", action: bathroom },
      { label:"거실로 간다", action: livingRoom },
      { label:"주방으로 간다", action: kitchen },
      { label:"현관으로 간다", action: entrance }
    ]
  );
}

function livingRoom() {
  if (randomKidnapper()) return;
  render(
    "거실이다. 서랍이 눈에 띈다.",
    [
      {
        label:"서랍을 조사한다",
        action: () => {
          state.hasSafeKey = true;
          render(
            "서랍 안에서 금고 열쇠를 발견했다.",
            [{ label:"돌아간다", action: hallFromBasement }]
          );
        }
      },
      { label:"돌아간다", action: hallFromBasement }
    ]
  );
}

function kitchen() {
  if (randomKidnapper()) return;
  render(
    "주방이다. 발소리가 가까워진다.",
    [
      {
        label:"화장실로 도망간다",
        action: bathroomHide
      },
      {
        label:"거실로 도망간다",
        action: livingRoom
      }
    ]
  );
}

function bathroom() {
  if (randomKidnapper()) return;
  render(
    "화장실이다. 숨을 곳이 보인다.",
    [
      { label:"문 뒤에 숨는다", action: hideSuccess },
      { label:"변기 뒤에 숨는다", action: hideSuccess },
      { label:"욕조 안에 숨는다", action: hideSuccess },
      { label:"나간다", action: hallFromBasement }
    ]
  );
}

function bathroomHide() {
  render(
    "황급히 화장실로 들어왔다.",
    [
      { label:"문 뒤에 숨는다", action: hideSuccess },
      { label:"변기 뒤에 숨는다", action: hideSuccess },
      { label:"욕조 안에 숨는다", action: hideSuccess }
    ]
  );
}

function hideSuccess() {
  render(
    "숨을 죽이고 기다렸다… 발소리가 멀어진다.",
    [{ label:"조심히 나온다", action: hallFromBasement }]
  );
}

function secondFloor() {
  if (randomKidnapper()) return;
  render(
    "2층 복도다. 더 조사할 곳은 없다.",
    [{ label:"내려간다", action: hallFromBasement }]
  );
}

function entrance() {
  if (randomKidnapper()) return;
  if (state.hasSafeKey) {
    render(
      "현관이다. 문이 열려 있다.\n밖으로 나갈 수 있다.",
      [{ label:"밖으로 나간다 (탈출)", action: ending }]
    );
  } else {
    render(
      "현관이다. 문은 잠겨 있다.",
      [{ label:"돌아간다", action: hallFromBasement }]
    );
  }
}

function ending() {
  render(
    "차가운 공기가 얼굴을 스친다.\n당신은 살아서 탈출했다.",
    []
  );
}

/* 시작 */
basement();
</script>

</body>
</html>
