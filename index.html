<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ìˆ¨ì„ ë©ˆì¶°ë¼</title>
<style>
body{
    background:#000;
    color:#eee;
    font-family:"Noto Serif KR",serif;
}
#game{
    max-width:600px;
    margin:60px auto;
    text-align:center;
}
button{
    padding:14px;
    width:100%;
    margin-top:20px;
    background:#111;
    color:#eee;
    border:1px solid #444;
    cursor:pointer;
}
#barWrap{
    width:100%;
    height:24px;
    background:#222;
    margin-top:30px;
}
#bar{
    height:100%;
    width:100%;
    background:#aaa;
    transition:width 0.2s;
}
.memo{
    color:#888;
    font-size:14px;
    margin-top:15px;
}
</style>
</head>

<body>
<div id="game">
    <h2>ìˆ¨ì„ ë©ˆì¶°ë¼</h2>
    <p>ì†Œë¦¬ê°€ ë“¤ë¦´ ë•Œ ìˆ¨ì„ ì°¸ì•„ì•¼ í•œë‹¤.</p>

    <div id="barWrap">
        <div id="bar"></div>
    </div>

    <button id="holdBtn">ìˆ¨ ì°¸ê¸°</button>
    <p class="memo">1ë¶„ë§Œ ë²„í‹°ë©´ êµ¬ì¡° ì‹ í˜¸ê°€ ì˜¨ë‹¤</p>
</div>

<script>
/* ====== ì‚¬ìš´ë“œ ====== */
const bgm = new Audio("./sound/Symmetry.mp3");
const leavesSfx = new Audio("./sound/fallenleaves.mp3");
const screamSfx = new Audio("./sound/screm2.mp3");

bgm.loop = true;
bgm.volume = 0.3; // ğŸ”‰ ì´ êµ¬ê°„ë§Œ ë³¼ë¥¨ ë‚®ì¶¤

leavesSfx.volume = 0.6;
screamSfx.volume = 0.7;

/* ====== ìƒíƒœ ====== */
let breath = 100;
let holding = false;
let timeLeft = 60;

let leavesTimer, screamTimer, tickTimer;

/* ====== ì‹œì‘ ====== */
document.body.addEventListener("click", unlock, {once:true});

function unlock(){
    bgm.play().catch(()=>{});
    startGame();
}

/* ====== ë°œìêµ­ ====== */
function playLeaves(){
    if(!leavesSfx.paused) return;

    const loud = Math.random() < 0.2; // ğŸ¯ 20% í™•ë¥ 
    leavesSfx.volume = loud ? 1.0 : 0.6;

    leavesSfx.currentTime = 0;
    leavesSfx.play();
}

/* ====== ë¹„ëª… ====== */
function playScream(){
    if(!screamSfx.paused){
        screamSfx.currentTime = 0;
    }
    screamSfx.play();
}

/* ====== ë¯¸ë‹ˆê²Œì„ ====== */
function startGame(){

    leavesTimer = setInterval(()=>{
        playLeaves();
    }, 8000 + Math.random()*4000); // â± 8~12ì´ˆ

    screamTimer = setInterval(()=>{
        playScream();
    }, 30000 + Math.random()*15000); // â± 30~45ì´ˆ

    tickTimer = setInterval(()=>{
        if(holding){
            breath -= 2;
        }else{
            breath += 1;
        }

        breath = Math.max(0, Math.min(100, breath));
        document.getElementById("bar").style.width = breath + "%";

        timeLeft--;

        if(breath <= 0){
            end("ìˆ¨ì´ ìƒˆì–´ë‚˜ê°”ë‹¤â€¦");
        }

        if(timeLeft <= 0){
            end("ë©€ë¦¬ì„œ ì‚¬ì´ë Œ ì†Œë¦¬ê°€ ë“¤ë¦°ë‹¤.");
        }
    },1000);
}

/* ====== ë²„íŠ¼ ====== */
const btn = document.getElementById("holdBtn");
btn.onmousedown = ()=> holding = true;
btn.onmouseup = ()=> holding = false;
btn.onmouseleave = ()=> holding = false;

/* ====== ì¢…ë£Œ ====== */
function end(msg){
    clearInterval(leavesTimer);
    clearInterval(screamTimer);
    clearInterval(tickTimer);

    bgm.pause();
    leavesSfx.pause();
    screamSfx.pause();

    document.getElementById("game").innerHTML =
        `<h2>${msg}</h2><p>â€¦</p>`;
}
</script>
</body>
</html>
