<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>탈출</title>
<style>
body{
  background:#000;
  color:#eee;
  font-family:"Noto Serif KR",serif;
  line-height:1.7;
}
#game{max-width:820px;margin:40px auto;padding:20px;}
.part{border-top:2px solid #333;margin-top:30px;padding-top:20px;}
button{
  width:100%;padding:12px;margin:8px 0;
  background:#111;color:#eee;border:1px solid #444;cursor:pointer;
}
button:hover{background:#222;}
.keypad{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;}
.display{
  background:#111;
  padding:12px;
  margin-bottom:10px;
  text-align:center;
  letter-spacing:6px;
  font-size:20px;
}
.memo{color:#aaa;font-style:italic;}
</style>
</head>

<body>
<div id="game"></div>

<script>
/* ================== 사운드 ================== */
const bgm = new Audio("./sound/TheDread.mp3");
const chaseBgm = new Audio("./sound/Anxiety.mp3");
const dialTone = new Audio("./sound/phone.mp3");   // 번호 누를 때
const connectTone = new Audio("./sound/phone.mp3"); // 통화 연결음 (같은 파일 재사용)

bgm.loop = true;
chaseBgm.loop = true;
connectTone.loop = true;

bgm.volume = 0.7;
chaseBgm.volume = 0.6;
dialTone.volume = 0.8;
connectTone.volume = 0.5;

let audioUnlocked = false;

function unlockAudio(){
  if(audioUnlocked) return;
  bgm.play().catch(()=>{});
  audioUnlocked = true;
}

/* ================== 상태 ================== */
const game=document.getElementById("game");
const state={
  input:"",
  calling:false
};

/* ================== 렌더 ================== */
function render(html){
  game.innerHTML = html;
}

/* ================== 시작 ================== */
function part0(){
render(`
<div class="part">
<h2>밖</h2>
<p>골목 끝에 공중전화가 있다.</p>
<p class="memo">전화기 아래 메모: 3849</p>
<button onclick="payphone()">공중전화</button>
</div>
`);
}

/* ================== 공중전화 ================== */
function payphone(){
  state.input="";
  state.calling=false;
  drawPayphone();
}

function drawPayphone(){
render(`
<h2>공중전화</h2>
<div class="display">${state.input || " "}</div>
<div class="keypad" id="pad"></div>
`);
const pad=document.getElementById("pad");

[1,2,3,4,5,6,7,8,9,0].forEach(n=>{
  const b=document.createElement("button");
  b.innerText=n;
  b.onclick=()=>{
    if(state.calling) return;
    dialTone.currentTime=0;
    dialTone.play();
    state.input+=n;
    drawPayphone();
  };
  pad.appendChild(b);
});

const ok=document.createElement("button");
ok.innerText="통화";
ok.onclick=startCall;
pad.appendChild(ok);
}

/* ================== 통화 처리 ================== */
function startCall(){
  if(state.calling) return;
  state.calling=true;

  render(`
  <h2>공중전화</h2>
  <p>…연결 중…</p>
  `);

  connectTone.currentTime=0;
  connectTone.play();

  setTimeout(()=>{
    connectTone.pause();
    handleCallResult();
  },2000);
}

function handleCallResult(){
  if(state.input==="112"){
    render(`
    <h2>히든 엔딩 : 사이렌</h2>
    <p>수화기 너머로 사이렌 소리가 번진다.</p>
    `);
  }
  else if(state.input==="3849"){
    render(`
    <h2>히든 엔딩 : 거래</h2>
    <p>낮고 건조한 목소리가 주소를 묻는다.</p>
    `);
  }
  else{
    render(`
    <h2>사망</h2>
    <p>뚝. 신호가 끊겼고, 뒤에서 숨소리가 들렸다.</p>
    `);
  }
}

part0();
</script>
</body>
</html>
