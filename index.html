<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>탈출</title>
<style>
body{
  background:#000;
  color:#eee;
  font-family:"Noto Serif KR",serif;
}
#game{
  max-width:820px;
  margin:40px auto;
  padding:20px;
}
button{
  width:100%;
  padding:12px;
  margin:6px 0;
  background:#111;
  color:#eee;
  border:1px solid #444;
  cursor:pointer;
}
button:hover{background:#222;}
.keypad{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:6px;
  margin-top:10px;
}
.display{
  border:1px solid #555;
  padding:10px;
  margin-bottom:10px;
  text-align:center;
  letter-spacing:4px;
  background:#000;
}
</style>
</head>
<body>
<div id="game"></div>

<script>
const game=document.getElementById("game");

const state={
  basementKey:false,
  safeKey:false,
  frontKey:false,
  caught:0,
  reason:"",
  input:""
};

/* ===== 공통 렌더 ===== */
function render(html,buttons=[]){
  game.innerHTML=html;
  buttons.forEach(b=>{
    const btn=document.createElement("button");
    btn.innerText=b.text;
    btn.onclick=b.action;
    game.appendChild(btn);
  });
}

/* ===== 랜덤 납치범 ===== */
function randomHunter(next){
  if(Math.random()<0.25){
    state.caught++;
    state.reason=[
      "발소리를 숨기지 못했다.",
      "숨은 위치가 발각됐다.",
      "너무 오래 머물렀다."
    ][Math.floor(Math.random()*3)];
    if(state.caught===1){
      basementCaptured();
    }else{
      death();
    }
  }else next();
}

/* ===== 시작 ===== */
function start(){
render(`<h2>새벽의 공원</h2>
<p>강아지와 산책 중, 뒤통수에 강한 충격이 왔다.</p>`,
[{text:"눈을 뜬다",action:room}]
);
}

/* ===== 방 ===== */
function room(){
render(`<h2>방</h2><p>잠긴 문과 어두운 공기.</p>`,[
{text:"문을 연다",action:()=>render(`<p>잠겨 있다.</p>`,[{text:"뒤로",action:room}])},
{text:"방을 조사한다",action:()=>{
  state.basementKey=true;
  render(`<p>지하실 열쇠를 발견했다.</p>`,[{text:"뒤로",action:room}])
}},
{text:"가만히 있는다",action:()=>randomHunter(room)}
]);
}

/* ===== 지하실 강제 ===== */
function basementCaptured(){
render(`<h2>지하실</h2>
<p>정신을 차리니 차가운 콘크리트 바닥이다.</p>`,[
{text:"계단으로 올라간다",action:house}
]);
}

/* ===== 집 내부 ===== */
function house(){
render(`<h2>집 내부</h2>`,[
{text:"거실",action:()=>randomHunter(livingroom)},
{text:"주방",action:()=>randomHunter(kitchen)}
]);
}

/* ===== 거실 ===== */
function livingroom(){
render(`<h2>거실</h2>
<p>TV 화면에 숫자가 반복된다. <b>3849</b></p>`,[
{text:"서랍",action:()=>{
  state.safeKey=true;
  render(`<p>금고 열쇠를 얻었다.</p>`,[{text:"뒤로",action:livingroom}])
}},
{text:"현관",action:frontDoor},
{text:"뒤로",action:house}
]);
}

/* ===== 주방 ===== */
function kitchen(){
render(`<h2>주방</h2><p>뒤에서 인기척이 느껴진다.</p>`,[
{text:"화장실로 도망",action:()=>randomHunter(house)},
{text:"숨는다",action:()=>randomHunter(house)}
]);
}

/* ===== 현관 비밀번호 UI ===== */
function frontDoor(){
if(!state.safeKey){
render(`<p>문 옆에 금고가 잠겨 있다.</p>`,[
{text:"뒤로",action:livingroom}
]);
return;
}
state.input="";
keypad("현관 비밀번호 입력", "3849", ()=>{
render(`<h2>현관 탈출</h2>
<p>문이 열렸다. 밖으로 나왔다.</p>`,[
{text:"공중전화로 간다",action:phoneBox},
{text:"도망친다",action:escapeEnd}
]);
});
}

/* ===== 키패드 공통 ===== */
function keypad(title,answer,success){
render(`<h2>${title}</h2>
<div class="display">${state.input}</div>
<div class="keypad"></div>`);
const pad=document.querySelector(".keypad");
for(let i=1;i<=9;i++) addKey(i,pad);
addKey(0,pad);
addKey("←",pad,()=>state.input=state.input.slice(0,-1));
addKey("확인",pad,()=>{
  if(state.input===answer) success();
  else render(`<p>틀렸다.</p>`,[{text:"다시",action:frontDoor}]);
});
function addKey(val,el,fn){
  const b=document.createElement("button");
  b.innerText=val;
  b.onclick=fn||(()=>{state.input+=val; keypad(title,answer,success)});
  el.appendChild(b);
}
}

/* ===== 공중전화 ===== */
function phoneBox(){
state.input="";
keypad("공중전화", "112", ()=>{
render(`<h2>진엔딩</h2>
<p>사이렌 소리가 들린다.<br>살아남았다.</p>`);
});
}

/* ===== 엔딩 ===== */
function escapeEnd(){
render(`<h2>엔딩</h2><p>뒤를 돌아보지 않고 달렸다.</p>`);
}

/* ===== 사망 ===== */
function death(){
render(`<h2>사망</h2>
<p>${state.reason}<br>두 번째 실수였다.</p>`);
}

start();
</script>
</body>
</html>
