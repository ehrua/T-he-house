<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>탈출</title>
<style>
body{
  background:#000;
  color:#eee;
  font-family:"Noto Serif KR",serif;
  line-height:1.7;
}
#game{
  max-width:820px;
  margin:40px auto;
  padding:20px;
}
.part{
  border-top:2px solid #333;
  margin-top:30px;
  padding-top:20px;
}
button{
  width:100%;
  padding:12px;
  margin:10px 0;
  background:#111;
  color:#eee;
  border:1px solid #444;
  cursor:pointer;
}
button:hover{background:#222;}
h2{margin-top:0;}
</style>
</head>
<body>
<div id="game"></div>

<script>
const game=document.getElementById("game");

const state={
  tweezers:false,
  basementKey:false,
  safeKey:false,
  frontKey:false,
  caught:0,
  history:[]
};

function render(text,options=[],back=false){
  game.innerHTML="";
  game.innerHTML=text;

  if(back && state.history.length){
    const b=document.createElement("button");
    b.innerText="뒤로 가기";
    b.onclick=()=>state.history.pop()();
    game.appendChild(b);
  }

  options.forEach(o=>{
    const btn=document.createElement("button");
    btn.innerText=o.text;
    btn.onclick=()=>{
      state.history.push(()=>render(text,options,back));
      o.action();
    };
    game.appendChild(btn);
  });
}

/* ================= PART 0 ================= */
function part0(){
render(`
<div class="part">
<h2>PART 0 : 새벽의 공원</h2>
<p>
사람이 없는 새벽, 강아지와 산책을 나왔다.<br>
강아지가 갑자기 멈춰 섰다.<br><br>
퍽.<br><br>
뒤통수에 충격이 느껴지고 의식이 끊겼다.
</p>
</div>
`,[{text:"눈을 뜬다",action:room}]);
}

/* ================= PART 1 ================= */
function room(){
render(`
<div class="part">
<h2>PART 1 : 방</h2>
<p>
신문지로 막힌 창문.<br>
여긴 감금된 장소다.
</p>
</div>
`,[
{text:"문으로 간다",action:door},
{text:"방을 살핀다",action:searchRoom},
{text:"대기한다",action:wait}
]);
}

function door(){
if(!state.tweezers){
render(`<p>문이 잠겨 있다. 도구가 필요하다.</p>`,[
{text:"뒤로",action:room}
]);
return;
}
render(`<p>핀셋으로 문을 열었다.</p>`,[
{text:"나간다",action:secondFloor}
]);
}

function searchRoom(){
render(`
<p>
장기 매매 문서다.<br>
이름: 판태현<br><br>
목적을 알았다.
</p>
`,[
{text:"서랍",action:getTweezers},
{text:"침대 밑",action:corpse}
],true);
}

function corpse(){
render(`<p>이미 실패한 사람의 흔적이다.</p>`,[
{text:"뒤로",action:searchRoom}
]);
}

function getTweezers(){
state.tweezers=true;
render(`<p>핀셋을 얻었다.</p>`,[
{text:"문으로 간다",action:door}
]);
}

function wait(){
state.caught++;
if(state.caught===1){
render(`<p>문이 열린다… 칼이 보인다.</p>`,[
{text:"눈을 뜬다",action:basementCaptured}
]);
}else{
death();
}
}

/* ================= PART 2 ================= */
function secondFloor(){
render(`
<div class="part">
<h2>PART 2 : 2층</h2>
<p>집은 생각보다 넓다.</p>
</div>
`,[
{text:"서재",action:library},
{text:"계단",action:kitchen}
]);
}

function library(){
render(`
<div class="part">
<h2>서재</h2>
<p>해부학 책들.</p>
</div>
`,[
{text:"메모",action:memo},
{text:"서랍",action:getBasementKey},
{text:"나간다",action:caughtMove}
],true);
}

function memo(){
render(`
<p><i>
현관은 비밀번호와 열쇠.<br>
지하실은 기회.<br>
두 번은 없다.
</i></p>
`,[{text:"뒤로",action:library}]);
}

function getBasementKey(){
state.basementKey=true;
render(`<p>지하실 열쇠를 얻었다.</p>`,[
{text:"뒤로",action:library}
]);
}

function caughtMove(){
state.caught++;
if(state.caught===1){
basementCaptured();
}else{
death();
}
}

/* ================= CAPTURE ================= */
function basementCaptured(){
render(`
<div class="part">
<h2>지하실</h2>
<p>이번엔 도끼다.</p>
</div>
`,[
{text:"버틴다",action:secondFloor}
]);
}

/* ================= PART 3 ================= */
function kitchen(){
render(`
<div class="part">
<h2>PART 3 : 주방</h2>
<p>인기척.</p>
</div>
`,[
{text:"도망",action:bathroom},
{text:"숨는다",action:caughtMove}
]);
}

function bathroom(){
render(`<p>숨을 곳은?</p>`,[
{text:"문 뒤",action:livingroom},
{text:"욕조",action:caughtMove}
]);
}

/* ================= PART 4 ================= */
function livingroom(){
render(`
<div class="part">
<h2>PART 4 : 거실</h2>
<p>거실이다.</p>
</div>
`,[
{text:"TV",action:tv},
{text:"서랍",action:livingDrawer},
{text:"지하실",action:basement}
]);
}

function livingDrawer(){
state.safeKey=true;
render(`<p>서랍에서 금고 열쇠를 얻었다.</p>`,[
{text:"뒤로",action:livingroom}
]);
}

function tv(){
render(`<p>TV에서 숫자 3849.</p>`,[
{text:"뒤로",action:livingroom}
]);
}

/* ================= PART 5 ================= */
function basement(){
if(!state.basementKey){
render(`<p>지하실은 잠겨 있다.</p>`,[
{text:"뒤로",action:livingroom}
]);
return;
}
render(`
<div class="part">
<h2>PART 5 : 지하실</h2>
<p>금고와 판자로 막힌 출구.</p>
</div>
`,[
{text:"금고",action:safe},
{text:"지하실 탈출",action:basementEscape}
]);
}

function safe(){
if(!state.safeKey){
render(`<p>금고는 열리지 않는다.</p>`,[
{text:"뒤로",action:basement}
]);
return;
}
state.frontKey=true;
render(`<p>현관 열쇠를 얻었다.</p>`,[
{text:"뒤로",action:basement}
]);
}

function basementEscape(){
if(state.caught>0 || !state.frontKey){
render(`<p>조건이 맞지 않는다.</p>`,[
{text:"뒤로",action:basement}
]);
return;
}
render(`
<h2>지하실 탈출 엔딩</h2>
<p>
도끼로 판자를 부쉈다.<br>
밖이다.
</p>
`);
}

function death(){
render(`<h2>사망</h2><p>두 번째 기회는 없다.</p>`);
}

part0();
</script>
</body>
</html>
