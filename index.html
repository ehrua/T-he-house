<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>숨 참기 테스트</title>
<style>
    body{
        background:#000;
        color:#eee;
        font-family:"Noto Serif KR",serif;
        display:flex;
        justify-content:center;
        align-items:center;
        height:100vh;
        margin:0;
    }
    #game{
        width:420px;
        text-align:center;
    }
    h2{margin-bottom:10px;}
    #barWrap{
        width:100%;
        height:24px;
        background:#222;
        border:1px solid #555;
        margin:20px 0;
    }
    #bar{
        height:100%;
        width:100%;
        background:#7a0000;
        transition:width 0.1s linear;
    }
    button{
        width:100%;
        padding:14px;
        font-size:18px;
        background:#111;
        color:#eee;
        border:1px solid #444;
        cursor:pointer;
    }
    button:active{
        background:#300;
    }
    #msg{
        margin-top:15px;
        min-height:40px;
        color:#aaa;
        font-size:14px;
    }
</style>
</head>
<body>

<div id="game">
    <h2>숨을 참아라</h2>
    <p>소리가 날 때는 숨을 쉬면 안 된다</p>

    <div id="barWrap">
        <div id="bar"></div>
    </div>

    <button id="holdBtn">숨 참기 (누르고 있기)</button>

    <div id="msg"></div>
</div>

<script>
/* ================== 오디오 ================== */
const leaves = new Audio("fallenleaves.mp3");
const scream = new Audio("screm2.mp3");
const hiddenBgm = new Audio("Symmetry.mp3");

hiddenBgm.loop = true;
hiddenBgm.volume = 0.4;

/* ================== 상태 ================== */
let gauge = 100;
let holding = false;
let soundPlaying = false;
let alive = true;
let surviveTime = 35; // 버텨야 하는 시간(초)

const bar = document.getElementById("bar");
const msg = document.getElementById("msg");
const btn = document.getElementById("holdBtn");

/* ================== 버튼 ================== */
btn.addEventListener("mousedown", ()=> holding=true);
btn.addEventListener("mouseup", ()=> holding=false);
btn.addEventListener("mouseleave", ()=> holding=false);

/* ================== 게이지 처리 ================== */
setInterval(()=>{
    if(!alive) return;

    if(holding){
        gauge -= 10; // 숨 참기 감소
    }else{
        if(soundPlaying){
            death("소리 위로 숨소리가 겹쳤다");
            return;
        }
        gauge += 5; // 회복
    }

    if(gauge <= 0){
        death("더 이상 숨을 참을 수 없었다");
        return;
    }

    if(gauge > 100) gauge = 100;
    bar.style.width = gauge + "%";
}, 200);

/* ================== 소리 이벤트 ================== */
function playSound(){
    soundPlaying = true;

    // 20% 확률 가짜 비명
    if(Math.random() < 0.2){
        scream.currentTime = 0;
        scream.play();
    }else{
        leaves.currentTime = 0;
        leaves.play();
    }

    msg.innerText = "…가까워진다";

    // 소리 길이
    setTimeout(()=>{
        soundPlaying = false;
        msg.innerText = "지금은 괜찮다";
    }, 2000 + Math.random()*1000);
}

// 랜덤 소리 반복
const soundLoop = setInterval(()=>{
    if(!alive) return;
    playSound();
}, 3500 + Math.random()*2000);

/* ================== 생존 타이머 ================== */
const timer = setInterval(()=>{
    if(!alive) return;
    surviveTime--;
    if(surviveTime <= 0){
        clearInterval(soundLoop);
        success();
    }
},1000);

/* ================== 결과 ================== */
function death(reason){
    alive = false;
    msg.innerText = "사망: " + reason;
}

function success(){
    alive = false;
    msg.innerText = "…끝내 아무도 찾지 못했다";
    hiddenBgm.play();
}
</script>

</body>
</html>
